import{a as w}from"./chunk-S53QGRZ7.js";import{a as S}from"./chunk-B3O2LPUN.js";import{a as nt}from"./chunk-IEKDCRBV.js";import{Ca as it,Da as et,G as Z,Qa as ct,Y as tt,f as K,g as Y,h as J,i as N,k as Q}from"./chunk-HICUQHPW.js";import{d as b,q}from"./chunk-OQ5IDZ4F.js";import{$a as $,Aa as f,Ba as U,Ja as W,Kc as A,Oa as F,Vb as X,Yb as j,Zb as G,da as D,ob as P}from"./chunk-BLTBCMH5.js";import{a as I}from"./chunk-6NE7JDAX.js";ct();var ft=["*"],mt={fillColor:void 0,strokeColor:"steelblue",strokeWidth:1,interpolation:"natural"},ht="natural",dt=new Date(-864e13),ut=new Date(864e13),st=300,ot=100,rt=60,R=30,v=50,_=18,Dt=(()=>{class k{constructor(){this.elementRef=D(U),this.document=D(b),this.platformId=D(W),this.currentConfiguration=[],this.currentData=[],this.currentDataEmpty=!0,this.width=f(st),this.height=f(ot),this.configuration=f.required(),this.timeAxis=f([]),this.valueAxis=f([]),this.min=f(),this.max=f(),this.from=f(),this.till=f(),this.data=f.required(),A(()=>{this.forcedValueMin=this.min()}),A(()=>{this.forcedValueMax=this.max()}),A(()=>{this.forcedTimeMin=this.from()}),A(()=>{this.forcedTimeMax=this.till()}),A(()=>{let i=this.data(),e=ut,a=dt,o=1/0,t=-1/0,d=!0;for(let l of i){let m=l.length;if(m<1)continue;d=!1,e>l[0].time&&(e=l[0].time),a<l[m-1].time&&(a=l[m-1].time);let M=w(l);for(let E of l){let u=M(E);isNaN(u)||(o>u&&(o=u),t<u&&(t=u))}}this.currentDataEmpty=d,this.dataTimeMin=e,this.dataTimeMax=a,this.dataValueMin=o,this.dataValueMax=t,this.currentData=i,this.render()}),A(()=>{let i=this.configuration();if(i&&i!=null&&i.length>0){let e=i.length,a=this.currentConfiguration.length;if(a>0){let o=Math.min(e,a);for(let t=0;t<o;++t)this.currentConfiguration[t]=I(I({},this.currentConfiguration[t]),i[t]);if(e>o)for(let t=o;t<e;++t)this.currentConfiguration[t]=I({},i[t])}else this.currentConfiguration=[...i]}this.render()}),F(()=>{this.render()})}render(){if(!q(this.platformId)||!this.document||this.document===null)return;let i=this.currentData;if(this.currentDataEmpty||!i||i===null||i.length<1)return;let e=Q(this.elementRef.nativeElement);if(!e||e===null)return;e.select("svg").remove();let a=this.currentConfiguration,o=this.timeAxis().includes("top"),t=this.timeAxis().includes("bottom"),d=this.valueAxis().includes("left"),l=this.valueAxis().includes("right"),m=this.valueAxis().includes("grid"),M=d||m?v:o||t?v/3:0,E=l?v:o||t?v/3:0,u=o?_:d||l||m?_/3:0,O=t?_:d||l||m?_/3:0,B=nt(this.elementRef,this.width(),this.height(),st,ot),g=B[0],x=B[1],T=e.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",g).attr("height",x).attr("viewBox",`0 0 ${g} ${x}`),y=this.forcedTimeMin===void 0?this.dataTimeMin:this.forcedTimeMin,L=this.forcedTimeMax===void 0?this.dataTimeMax:this.forcedTimeMax,C=tt().range([M,g-E]).domain([y,L]);if(o){C.nice();let n=r=>r.attr("font-family","sans-serif").attr("font-size",10).attr("fill","none").attr("transform",`translate(0,${u})`).call(K(C).ticks(g/rt).tickSizeOuter(0));T.append("g").call(n)}if(t){C.nice();let n=r=>r.attr("font-family","sans-serif").attr("font-size",10).attr("fill","none").attr("transform",`translate(0,${x-O})`).call(J(C).ticks(g/rt).tickSizeOuter(0));T.append("g").call(n)}let H=this.forcedValueMin===void 0?this.dataValueMin:this.forcedValueMin,at=this.forcedValueMax===void 0?this.dataValueMax:this.forcedValueMax,h=Z().domain([H,at]).range([x-O,u]);if(d&&!m){h.nice();let n=r=>r.attr("transform",`translate(${M},0)`).call(N(h).ticks(x/R).tickSizeOuter(0));T.append("g").call(n)}if(l){h.nice();let n=r=>r.attr("transform",`translate(${g-E},0)`).call(Y(h).ticks(x/R).tickSizeOuter(0));T.append("g").call(n)}if(m){h.nice();let n=r=>r.attr("transform",`translate(${M},0)`).call(N(h).ticks(x/R).tickSizeOuter(0)).call(p=>{d||p.select(".domain").remove()}).call(p=>p.selectAll(t?".tick:not(:first-of-type) line":".tick line").clone().attr("x2",g-M-E).attr("stroke","currentColor").attr("stroke-width",.3));T.append("g").call(n)}let lt=a.length;for(let n=0;n<i.length;++n){let r=i[n],p=w(r),c=n<lt?a[n]:mt,z=c.interpolation?c.interpolation:ht;if(c.fillColor&&c.fillColor!=="none"){let V=et().curve(S(z)).defined(s=>!isNaN(p(s))&&s.time>=y&&s.time<=L).x(s=>C(s.time)).y0(()=>h(H)).y1(s=>h(p(s)));T.append("path").datum(r).attr("fill",c.fillColor).attr("d",V)}if(c.strokeColor&&c.strokeWidth&&c.strokeWidth>0&&c.strokeColor!=="none"){let V=it().curve(S(z)).defined(s=>!isNaN(p(s))&&s.time>=y&&s.time<=L).x(s=>C(s.time)).y(s=>h(p(s)));T.append("path").datum(r).attr("stroke-width",c.strokeWidth).attr("stroke",c.strokeColor).attr("stroke-linejoin","round").attr("stroke-linecap","round").style("fill","none").attr("d",V)}}}static{this.\u0275fac=function(e){return new(e||k)}}static{this.\u0275cmp=P({type:k,selectors:[["mb-multiline"]],hostBindings:function(e,a){e&1&&X("resize",function(){return a.render()},!1,$)},inputs:{width:[1,"width"],height:[1,"height"],configuration:[1,"configuration"],timeAxis:[1,"timeAxis"],valueAxis:[1,"valueAxis"],min:[1,"min"],max:[1,"max"],from:[1,"from"],till:[1,"till"],data:[1,"data"]},ngContentSelectors:ft,decls:1,vars:0,template:function(e,a){e&1&&(j(),G(0))},encapsulation:2,changeDetection:0})}}return k})();export{Dt as a};
