import{c as V,g as Y}from"./chunk-CGVYBZUD.js";import{$ as I,C as G,a as H,d as F,e as E,f as q,g as P,ha as J,k as Z,l as _}from"./chunk-JEPWSQCW.js";import{a as B}from"./chunk-IEKDCRBV.js";import{Qa as X,k as W,r as j,x as A,y as T}from"./chunk-GDNQNY7K.js";import{Aa as v,Cc as i,Nb as D,Pb as L,Qb as N,Ua as O,ba as S,gb as $,xa as R}from"./chunk-OH5MFEO2.js";X();var tt=["*"],g=300,et=750,K="asc",it="desc",nt=!0,ot="white",st="0px 0px 8px #000000",at=1,lt=3,rt=!1,ct=!1,vt=(()=>{let l=class l{constructor(){this.elementRef=S(v),this.sumFunc=i(H),this.sort=i(K),this.zoom=i(nt),this.transitionMsec=i(et),this.labelFunc=i(P),this.labelMinRadius=i(at),this.labelFill=i(ot),this.labelShadow=i(st),this.labelFontSizeFunc=i(J),this.tooltipFunc=i(Z),this.tapFunc=i(_),this.fillFunc=i(G),this.fillOpacityFunc=i(I),this.strokeFunc=i(V),this.strokeWidthFunc=i(Y),this.padding=i(lt),this.diameter=i(g),this.data=i.required(),this.flat=i(rt),this.rootCircle=i(ct)}ngOnChanges(r){this.render()}render(){let r=W(this.elementRef.nativeElement);r.select("svg").remove();let s=this.data();if(!s||!s.children||s.children.length<1)return;let d=B(this.elementRef,this.diameter(),this.diameter(),g,g),a=Math.max(d[0],d[1]),b=a/2,p=r.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",a).attr("height",a).attr("viewBox",`-${b} -${b} ${a} ${a}`).on("click",t=>M(t,o)),y=this.sort(),k=y===K?E:y===it?q:F,x=t=>{let e=A(t).sum(this.sumFunc());return k!==F&&(e=e.sort((n,f)=>k(n,f))),T().size([a,a]).padding(this.padding())(e)},o=x(s);if(this.flat()){let t={children:[]};for(let e of o.leaves())t.children?.push(e.data);o=x(t)}let c=o,u=p.append("g").selectAll("circle").data(this.rootCircle()?o.descendants():o.descendants().slice(1)).join("circle").attr("fill",this.fillFunc()).attr("fill-opacity",t=>this.fillOpacityFunc()(t,o.height)).attr("stroke",t=>this.strokeFunc()(t)).attr("stroke-width",t=>this.strokeWidthFunc()(t)).on("click",(t,e)=>{t.stopPropagation(),Q(t,e)}),z=t=>t.parent===c&&t.r>=this.labelMinRadius()?1:0,m=p.append("g").style("fill",this.labelFill()).style("text-shadow",this.labelShadow()).style("user-select","none").attr("pointer-events","none").attr("text-anchor","middle").selectAll("text").data(o.descendants()).enter().append("text").style("fill-opacity",z).style("font-size",t=>this.labelFontSizeFunc()(t));m.selectAll("tspan").data(t=>this.labelFunc()(t).split(/\s+/g)).join("tspan").attr("x",0).attr("y",(t,e,n)=>`${e-n.length/2+.8}em`).text(t=>t);let Q=(t,e)=>{this.tapFunc()(e),this.zoom()&&!this.flat()&&e.children&&c!==e&&M(t,e)},w,C=t=>{w=t;let e=a/t[2];m.attr("transform",n=>`translate(${(n.x-t[0])*e},${(n.y-t[1])*e+this.labelFontSizeFunc()(n)/4})`),u.attr("transform",n=>`translate(${(n.x-t[0])*e},${(n.y-t[1])*e})`),u.attr("r",n=>n.r*e)},M=(t,e)=>{c=e;let n=p.transition().duration(this.transitionMsec()).tween("zoom",()=>{let f=j(w,[c.x,c.y,c.r*2]);return U=>C(f(U))});m.transition(n).style("fill-opacity",z)};u.append("title").text(t=>this.tooltipFunc()(t)),C([o.x,o.y,o.r*2])}};l.\u0275fac=function(s){return new(s||l)},l.\u0275cmp=$({type:l,selectors:[["mb-circlepack"]],hostBindings:function(s,d){s&1&&D("resize",function(){return d.render()},O)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],zoom:[1,"zoom"],transitionMsec:[1,"transitionMsec"],labelFunc:[1,"labelFunc"],labelMinRadius:[1,"labelMinRadius"],labelFill:[1,"labelFill"],labelShadow:[1,"labelShadow"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],strokeFunc:[1,"strokeFunc"],strokeWidthFunc:[1,"strokeWidthFunc"],padding:[1,"padding"],diameter:[1,"diameter"],data:[1,"data"],flat:[1,"flat"],rootCircle:[1,"rootCircle"]},features:[R],ngContentSelectors:tt,decls:1,vars:0,template:function(s,d){s&1&&(L(),N(0))},encapsulation:2,changeDetection:0});let h=l;return h})();export{vt as a};
