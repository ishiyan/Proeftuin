import{a as Z}from"./chunk-S53QGRZ7.js";import{a as N}from"./chunk-M2DMPW5Q.js";import{a as Q}from"./chunk-IEKDCRBV.js";import{Ca as Y,Da as J,G as q,Qa as rt,Y as K,f as X,g as j,h as G,i as V,k as P}from"./chunk-GDNQNY7K.js";import{Aa as B,Cc as d,Nb as F,Pb as $,Qb as b,Ua as W,ba as R,gb as U,xa as z,zc as C}from"./chunk-OH5MFEO2.js";import{a as y}from"./chunk-VOSPIT4N.js";rt();var at=["*"],ct={fillColor:void 0,strokeColor:"steelblue",strokeWidth:1,interpolation:"natural"},lt="natural",ft=new Date(-864e13),ht=new Date(864e13),tt=300,et=100,it=60,O=30,D=50,I=18,kt=(()=>{let M=class M{constructor(){this.elementRef=R(B),this.width=d(tt),this.height=d(et),this.timeAxis=d([]),this.valueAxis=d([]),this.currentConfiguration=[],this.currentDataStacked=[],this.currentDataEmpty=!0,this.configuration=d.required(),this.min=d(),this.max=d(),this.from=d(),this.till=d(),this.data=d.required(),C(()=>{this.forcedValueMin=this.min()}),C(()=>{this.forcedValueMax=this.max()}),C(()=>{this.forcedTimeMin=this.from()}),C(()=>{this.forcedTimeMax=this.till()}),C(()=>{let e=this.data(),i=ht,f=ft,c=-1/0,t=!0,m=[],p=0;for(let n of e){m.push([]);let l=n.length;l<1||(t=!1,p<l&&(p=l),i>n[0].time&&(i=n[0].time),f<n[l-1].time&&(f=n[l-1].time))}let g=e.length;for(let n=0;n<p;++n){let l=0;for(let x=0;x<g;++x){let v=m[x],A=e[x];if(A.length>n){let a=Z(A)(A[n]);isNaN(a)||(a+=l,v.push({time:A[n].time,lower:l,upper:a}),l=a,c<a&&(c=a))}}}this.currentDataEmpty=t,this.dataTimeMin=i,this.dataTimeMax=f,this.dataValueMax=c,this.currentDataStacked=m,this.render()}),C(()=>{let e=this.configuration();if(e&&e!=null&&e.length>0){let i=e.length,f=this.currentConfiguration.length;if(f>0){let c=Math.min(i,f);for(let t=0;t<c;++t)this.currentConfiguration[t]=y(y({},this.currentConfiguration[t]),e[t]);if(i>c)for(let t=c;t<i;++t)this.currentConfiguration[t]=y({},e[t])}else this.currentConfiguration=[...e]}this.render()})}ngAfterViewInit(){setTimeout(()=>this.render(),0)}ngOnChanges(e){this.render()}render(){let e=P(this.elementRef.nativeElement);e.select("svg").remove();let i=this.currentDataStacked;if(this.currentDataEmpty||!i||i.length<1)return;let f=this.currentConfiguration,c=this.timeAxis().includes("top"),t=this.timeAxis().includes("bottom"),m=this.valueAxis().includes("left"),p=this.valueAxis().includes("right"),g=this.valueAxis().includes("grid"),n=m||g?D:c||t?D/3:0,l=p?D:c||t?D/3:0,x=c?I:m||p||g?I/3:0,v=t?I:m||p||g?I/3:0,A=Q(this.elementRef,this.width(),this.height(),tt,et),a=A[0],T=A[1],k=e.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",a).attr("height",T).attr("viewBox",`0 0 ${a} ${T}`),_=this.forcedTimeMin===void 0?this.dataTimeMin:this.forcedTimeMin,S=this.forcedTimeMax===void 0?this.dataTimeMax:this.forcedTimeMax,E=K().range([n,a-l]).domain([_,S]);if(c){E.nice();let s=h=>h.attr("font-family","sans-serif").attr("font-size",10).attr("fill","none").attr("transform",`translate(0,${x})`).call(X(E).ticks(a/it).tickSizeOuter(0));k.append("g").call(s)}if(t){E.nice();let s=h=>h.attr("font-family","sans-serif").attr("font-size",10).attr("fill","none").attr("transform",`translate(0,${T-v})`).call(G(E).ticks(a/it).tickSizeOuter(0));k.append("g").call(s)}let nt=this.forcedValueMin===void 0?0:this.forcedValueMin,st=this.forcedValueMax===void 0?this.dataValueMax:this.forcedValueMax,u=q().domain([nt,st]).range([T-v,x]);if(m&&!g){u.nice();let s=h=>h.attr("transform",`translate(${n},0)`).call(V(u).ticks(T/O).tickSizeOuter(0));k.append("g").call(s)}if(p){u.nice();let s=h=>h.attr("transform",`translate(${a-l},0)`).call(j(u).ticks(T/O).tickSizeOuter(0));k.append("g").call(s)}if(g){u.nice();let s=h=>h.attr("transform",`translate(${n},0)`).call(V(u).ticks(T/O).tickSizeOuter(0)).call(o=>{m||o.select(".domain").remove()}).call(o=>o.selectAll(t?".tick:not(:first-of-type) line":".tick line").clone().attr("x2",a-n-l).attr("stroke","currentColor").attr("stroke-width",.3));k.append("g").call(s)}let ot=f.length;for(let s=0;s<i.length;++s){let h=i[s],o=s<ot?f[s]:ct,H=o.interpolation?o.interpolation:lt;if(o.fillColor&&o.fillColor!=="none"){let w=J().curve(N(H)).defined(r=>r.time>=_&&r.time<=S).x(r=>E(r.time)).y0(r=>u(r.lower)).y1(r=>u(r.upper));k.append("path").datum(h).attr("fill",o.fillColor).attr("d",w)}if(o.strokeColor&&o.strokeWidth&&o.strokeWidth>0&&o.strokeColor!=="none"){let w=Y().curve(N(H)).defined(r=>r.time>=_&&r.time<=S).x(r=>E(r.time)).y(r=>u(r.upper));k.append("path").datum(h).attr("stroke-width",o.strokeWidth).attr("stroke",o.strokeColor).attr("stroke-linejoin","round").attr("stroke-linecap","round").style("fill","none").attr("d",w)}}}};M.\u0275fac=function(i){return new(i||M)},M.\u0275cmp=U({type:M,selectors:[["mb-stackiline"]],hostBindings:function(i,f){i&1&&F("resize",function(){return f.render()},W)},inputs:{width:[1,"width"],height:[1,"height"],timeAxis:[1,"timeAxis"],valueAxis:[1,"valueAxis"],configuration:[1,"configuration"],min:[1,"min"],max:[1,"max"],from:[1,"from"],till:[1,"till"],data:[1,"data"]},features:[z],ngContentSelectors:at,decls:1,vars:0,template:function(i,f){i&1&&($(),b(0))},encapsulation:2,changeDetection:0});let L=M;return L})();export{kt as a};
