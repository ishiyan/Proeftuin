import{a as Se,b as Ve,c as J}from"./chunk-B7BD3WOC.js";import{a as Te,b as Re,c as Be}from"./chunk-XES2XT3G.js";import{a as jt}from"./chunk-U54PXVMY.js";import{g as Wt,i as $t,r as Dt}from"./chunk-54ETGEND.js";import{d as Et,e as Ut,f as Yt}from"./chunk-QNLWUMVA.js";import{a as C}from"./chunk-AGLP4XTE.js";import{d as Gt}from"./chunk-PY7PJETT.js";import{$ as Kt,Ba as ye,Ca as $,Da as D,Ea as Ae,Fa as Pe,G as E,Ga as be,Ka as Ce,La as ke,Ma as Me,Na as Le,Qa as $e,V as W,Z as Xt,_ as Jt,aa as Qt,ba as Zt,ca as te,da as ee,ea as ie,fa as ae,g as bt,ga as ne,h as Ct,ha as re,i as kt,ia as oe,ja as se,k as X,ka as ce,la as Mt,ma as le,na as he,oa as de,qa as pe,ra as me,sa as ue,ta as fe,v as qt,w as k,wa as ge,xa as xe,ya as ve,za as we}from"./chunk-GDNQNY7K.js";import{o as _t}from"./chunk-FM2UNIMX.js";import{Cb as T,Cc as Ot,Db as M,Eb as S,Fa as Rt,Fb as _,Jb as vt,Nb as q,Ob as R,Ua as Bt,Wa as L,Yb as zt,ac as B,ba as N,cc as Nt,fc as wt,ga as H,gb as It,gc as yt,ha as O,hc as At,ic as Pt,la as Tt,qb as Ft,wb as gt,xb as xt,zc as Ht}from"./chunk-OH5MFEO2.js";$e();var V=class{constructor(d){if(d)for(let A in d)Object.prototype.hasOwnProperty.call(d,A)&&(this[A]=d[A])}};var K=class{constructor(){this.height=30,this.hasLine=!0,this.hasArea=!1,this.hasTimeAxis=!0}};var Q=class{constructor(){this.left=0,this.top=0,this.right=0,this.bottom=0}};var Z=class{constructor(){this.name="",this.data=[],this.candlesticks=!0}};var tt=class{constructor(){this.height=0,this.valueFormat=",.2f",this.valueMarginPercentageFactor=0,this.bands=[],this.lineAreas=[],this.horizontals=[],this.lines=[],this.arrows=[]}};var et=class{constructor(){this.navigationPane=new K,this.axisLeft=!0,this.axisRight=!1,this.margin=new Q,this.ohlcv=new Z,this.pricePane=new tt,this.indicatorPanes=[],this.crosshair=!1,this.volumeInPricePane=!1,this.menuVisible=!0,this.downloadSvgVisible=!0}};var it=class{constructor(){this.top=0,this.height=0}};var at=class{constructor(){this.height=0,this.pricePane={top:0,height:0},this.indicatorPanes=[],this.timeAxis={top:0,height:0},this.navigationPane={top:0,height:0}}};var nt=class{};var G=class{};var rt=class{};var U=class{};var Y=class{};var j=class{};var ot=class{constructor(){this.indicatorBands=[],this.indicatorLineAreas=[],this.indicatorHorizontals=[],this.indicatorLines=[]}draw(d,A){let i=A.groupPrice.datum(),e=i.length-1,n=d.timeScale.zoomable().domain(),l=Math.round(n[0]),h=Math.round(n[1]);l<0&&(l=0),h>e&&(h=e),i[l]!==void 0&&(l=+i[l].time),i[h]!==void 0&&(h=+i[h].time);let p=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MAX_VALUE,f=Number.MIN_VALUE;if(this.indicatorHeatmap){let a=this.indicatorHeatmap.data;if(a.length>0){let r=a[0].parameterFirst,t=a[0].parameterLast;p=Math.min(r,t),s=Math.max(r,t);for(let u of a){let v=+u.time;l<=v&&v<=h&&u.values.length>0&&(o>u.valueMin&&(o=u.valueMin),f<u.valueMax&&(f=u.valueMax))}(f===Number.MIN_VALUE||o===Number.MAX_VALUE)&&(o=0,f=0)}}for(let a of this.indicatorBands){let r=a.data;for(let t of r){let u=+t.time;l<=u&&u<=h&&(p>t.lower&&(p=t.lower),s<t.upper&&(s=t.upper))}}for(let a of this.indicatorLineAreas){let r=a.data,t=a.value;for(let u of r){let v=+u.time;l<=v&&v<=h&&(p>u.value&&(p=u.value),s<u.value&&(s=u.value),p>t&&(p=t),s<t&&(s=t))}}for(let a of this.indicatorHorizontals){let r=a.value;p>r&&(p=r),s<r&&(s=r)}for(let a of this.indicatorLines){let r=a.data;for(let t of r){let u=+t.time;if(l<=u&&u<=h){let v=t.value;p>v&&(p=v),s<v&&(s=v)}}}if(this.indicatorHeatmap?this.yValue.domain([p,s]).nice():(p*=this.yMarginFactorBottom,s*=this.yMarginFactorTop,this.yValue.domain([p,s]).nice()),this.indicatorHeatmap){this.indicatorHeatmap.path.selectAll("image").remove();let a=this.indicatorHeatmap.data;if(a.length>0){let r=1+(a.length>1?d.timeScale(a[1].time)-d.timeScale(a[0].time):A.priceShape.width()(d.timeScale)),t=this.indicatorHeatmap.height,u=this.indicatorHeatmap.gradient,v=this.indicatorHeatmap.invertGradient,y=a[0].parameterFirst,w=a[0].parameterLast,c=a[0].parameterResolution,m=y>w,g=Math.min(y,w);for(let x of a){let P=+x.time;if(l<=P&&P<=h&&x.values.length>0){let Ee=d.timeScale(P)-r/2,We=this.heatColumn(x,g,c,m,x.valueMin,x.valueMax,u,v,r,t);this.indicatorHeatmap.path.append("image").attr("x",Ee).attr("width",r).attr("y",0).attr("height",t).attr("preserveAspectRatio","none").attr("xlink:href",We.toDataURL())}}}}this.indicatorBands.forEach(a=>a.path.attr("d",a.area)),this.indicatorLineAreas.forEach(a=>a.path.attr("d",a.area)),this.indicatorHorizontals.forEach(a=>a.path.attr("d",a.line)),this.indicatorLines.forEach(a=>a.path.attr("d",a.line)),this.yAxisLeft&&this.groupAxisLeft.call(this.yAxisLeft),this.yAxisRight&&this.groupAxisRight.call(this.yAxisRight)}setIndicatorDatum(){for(let d of this.indicatorBands)d.path.datum(d.data);for(let d of this.indicatorLineAreas)d.path.datum(d.data);for(let d of this.indicatorHorizontals)d.path.datum(d.data);for(let d of this.indicatorLines)d.path.datum(d.data)}heatColumn(d,A,i,e,n,l,h,p,s,o){let f=document.createElement("canvas");f.width=s,f.height=o,f.style.width=s+"px",f.style.height=o+"px",f.style.imageRendering="pixelated";let a=f.getContext("2d"),r=this.yValue,t=d.values;if(n!==0&&l!==1){let u=l-n;for(let v=0;v<o;++v){let y=Math.round((r.invert(v)-A)*i),w=(t[y]-n)/u;a.fillStyle=h(p?1-w:w),a.fillRect(0,e?o-v:v,s,1)}}else for(let u=0;u<o;++u){let v=Math.round((r.invert(u)-A)*i),y=t[v];a.fillStyle=h(p?1-y:y),a.fillRect(0,e?o-u:u,s,1)}return f}};var st=class{};var ct=class{constructor(){this.indicatorBands=[],this.indicatorLineAreas=[],this.indicatorHorizontals=[],this.indicatorLines=[],this.indicatorArrows=[]}draw(d){let A=this.groupPrice.datum(),i=A.length-1,e=d.timeScale.zoomable().domain(),n=Math.round(e[0]),l=Math.round(e[1]);n<0&&(n=0),l>i&&(l=i);let h=C.scale.plot.ohlc(A.slice.apply(A,[n,l]),this.priceAccessor).domain();A[n]!==void 0&&(n=+A[n].time),A[l]!==void 0&&(l=+A[l].time);let p=h[0],s=h[1];for(let a of this.indicatorBands){let r=a.data;for(let t of r){let u=+t.time;n<=u&&u<=l&&(p>t.lower&&(p=t.lower),s<t.upper&&(s=t.upper))}}for(let a of this.indicatorLineAreas){let r=a.data,t=a.value;for(let u of r){let v=+u.time;n<=v&&v<=l&&(p>u.value&&(p=u.value),s<u.value&&(s=u.value),p>t&&(p=t),s<t&&(s=t))}}for(let a of this.indicatorHorizontals){let r=a.value;p>r&&(p=r),s<r&&(s=r)}for(let a of this.indicatorLines){let r=a.data;for(let t of r){let u=+t.time;if(n<=u&&u<=l){let v=t.value;p>v&&(p=v),s<v&&(s=v)}}}let o,f;if(this.indicatorArrows.length>0){let a=this.priceShape.width()(d.timeScale);o=a<3?3:a,f=o*1.25;let r=f+3,t=this.yPrice.range()[0];if(r<t){let u=t-r;for(let v of this.indicatorArrows){let y=v.price,w=y*t;if(s<y&&(s=y),p>y&&(p=y),v.isDown){let c=(w-p*r)/u;s<c&&(s=c)}else{let c=(w-s*r)/u;p>c&&(p=c),p<0&&(p=0)}}}}p*=this.yMarginFactorBottom,s*=this.yMarginFactorTop,this.yPrice.domain([p,s]).nice(),this.indicatorBands.forEach(a=>a.path.attr("d",a.area)),this.indicatorLineAreas.forEach(a=>a.path.attr("d",a.area)),this.groupPrice.call(this.priceShape),this.volume&&this.groupVolume.call(this.volume),this.indicatorHorizontals.forEach(a=>a.path.attr("d",a.line)),this.indicatorLines.forEach(a=>a.path.attr("d",a.line));for(let a of this.indicatorArrows)a.arrow.width(o).height(f),a.path.attr("d",a.arrow);this.yAxisLeft&&this.groupAxisLeft.call(this.yAxisLeft),this.yAxisRight&&this.groupAxisRight.call(this.yAxisRight)}setIndicatorDatum(){this.indicatorBands.forEach(d=>d.path.datum(d.data)),this.indicatorLineAreas.forEach(d=>d.path.datum(d.data)),this.indicatorHorizontals.forEach(d=>d.path.datum(d.data)),this.indicatorLines.forEach(d=>d.path.datum(d.data))}};var ht=class{draw(){this.group.call(this.timeAxis)}};function Ye(b,d){if(b&1){let A=vt();M(0,"button",10),q("click",function(){H(A);let e=R(2);return O(e.downloadSvg())}),M(1,"mat-icon"),B(2,"download"),S()()}}function je(b,d){if(b&1){let A=vt();M(0,"mat-expansion-panel",2)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon"),B(4,"tune"),S(),B(5),S()(),M(6,"mat-button-toggle-group",4,0),q("change",function(){H(A);let e=zt(7),n=R();return O(n.ohlcvViewType=e.value)}),M(8,"mat-button-toggle",5),_(9,"mat-icon",6),S(),M(10,"mat-button-toggle",5),_(11,"mat-icon",7),S()(),M(12,"mat-slide-toggle",8),At("ngModelChange",function(e){H(A);let n=R();return yt(n.viewVolume,e)||(n.viewVolume=e),O(e)}),M(13,"mat-icon"),B(14,"leaderboard"),S()(),M(15,"mat-slide-toggle",8),At("ngModelChange",function(e){H(A);let n=R();return yt(n.viewCrosshair,e)||(n.viewCrosshair=e),O(e)}),M(16,"mat-icon"),B(17,"add"),S()(),gt(18,Ye,3,0,"button",9),S()}if(b&2){let A=R();L(5),Nt("\xA0",A.chartTitle),L(),T("value",A.ohlcvViewType),L(2),T("value",A.ohlcvViewCandlesticks),L(2),T("value",A.ohlcvViewBars),L(2),wt("ngModel",A.viewVolume),L(3),wt("ngModel",A.viewCrosshair),L(3),xt(A.viewDownloadSvg?18:-1)}}var dt=0,Lt=1,Fe=50,ze=10,pt=22,I=8,mt=5,St=50,ut=6,ft=20,F=6,Vt=20,qe=6,Ne=100,Xe=20,He=new Date(-864e13),Oe=new Date(864e13),Je=`<html><meta charset="utf-8"><style>
  text { fill: black; font-family: Arial, Helvetica, sans-serif; }
  path.candle { stroke: black; }
  path.candle.up { fill: white; }
  path.candle.down { fill: black; }
  path.ohlc.up { fill: none; stroke: black; }
  path.ohlc.down { fill: none; stroke: black; }
  path.volume { fill: lightgrey; }
  path.area { fill: lightgrey; }
  path.line { stroke: black; }
  rect.selection { fill: darkgrey; }
</style><body>
`,Ke=`
</body></html>
`,_e=!1,wa=(()=>{let d=class d{static valueToPixels(i,e){if(typeof i=="number")return+i;let n=+i.match(/\d+/);return i.endsWith("%")?n/100*e:n}static layoutHorizontal(i,e){let n=d.valueToPixels(i.width,e);i.widthMin&&i.widthMin>n&&(n=i.widthMin),i.widthMax&&i.widthMax<n&&(n=i.widthMax);let l=i.margin.left,h=n-l-i.margin.right,p=i.axisLeft?Fe:0,s=h-p-(i.axisRight?Fe:0);return{width:n,chart:{left:l,width:h},content:{left:p,width:s}}}static textBoundingClientRect(i,e=!1){let n=i.node(),l;return n&&n!=null?(l=n.getBoundingClientRect(),e&&i.remove()):l={width:100,height:12},l}static layoutVertical(i,e,n){let l=i.append("text").text("w"),h=d.textBoundingClientRect(l,!0).height,p=d.appendLegend(i,e.margin.top,h,n.content.left,n.content.width,e.pricePane,e.ohlcv.name),s=new at;s.pricePane.top=e.margin.top+p;let o=d.valueToPixels(e.pricePane.height,n.content.width);e.pricePane.heightMin&&e.pricePane.heightMin>o&&(o=e.pricePane.heightMin),e.pricePane.heightMax&&e.pricePane.heightMax<o&&(o=e.pricePane.heightMax),s.pricePane.height=o;let f=s.pricePane.top+s.pricePane.height;if(e.indicatorPanes&&e.indicatorPanes.length)for(let a of e.indicatorPanes){let r=new it,t=d.appendLegend(i,f,h,n.content.left,n.content.width,a,void 0);r.top=f+t,o=d.valueToPixels(a.height,n.content.width),a.heightMin&&a.heightMin>o&&(o=a.heightMin),a.heightMax&&a.heightMax<o&&(o=a.heightMax),r.height=o,s.indicatorPanes.push(r),f=r.top+r.height}if(s.timeAxis.top=f,s.timeAxis.height=pt,f+=s.timeAxis.height,s.navigationPane.top=f,e.navigationPane){let a=e.navigationPane;o=d.valueToPixels(a.height,n.content.width),a.heightMin&&a.heightMin>o&&(o=a.heightMin),a.heightMax&&a.heightMax<o&&(o=a.heightMax),a.hasTimeAxis&&(!a.timeTicks||a.timeTicks>0)&&(o+=pt),s.navigationPane.height=o,f+=o}return s.height=f+e.margin.bottom,s}static appendLegend(i,e,n,l,h,p,s=""){i=i.append("g").attr("class","legend"),e+=n/2,l+=I;let o=l,f=0;if(s&&s.length>0){let a=d.appendText(i,o,e,` ${s} `),r=d.textBoundingClientRect(a);o+=r.width+I,f=r.height}if(p.heatmap){let a=i.append("image").attr("x",o).attr("y",e-ut).attr("width",St).attr("height",ut).attr("preserveAspectRatio","none").attr("xlink:href",d.ramp(d.convertGradient(p.heatmap.gradient),p.heatmap.invertGradient,St,ut).toDataURL()),r=St+mt;o+=r;let t=d.appendText(i,o,e,p.heatmap.name),u=d.textBoundingClientRect(t);f===0&&(f=u.height);let v=u.width;o+v>h&&(e+=u.height,f+=u.height,a.attr("x",l).attr("y",e-ut),o=l+r,t.attr("x",o).attr("y",e)),o+=v+I}for(let a of p.bands){let r=i.append("rect").attr("x",o).attr("y",e-F).attr("width",ft).attr("height",F).attr("stroke-width",0).attr("fill",a.color),t=ft+mt;o+=t;let u=d.appendText(i,o,e,a.name),v=d.textBoundingClientRect(u);f===0&&(f=v.height);let y=v.width;o+y>h&&(e+=v.height,f+=v.height,r.attr("x",l).attr("y",e-F),o=l+t,u.attr("x",o).attr("y",e)),o+=y+I}for(let a of p.lineAreas){let r=i.append("rect").attr("x",o).attr("y",e-F).attr("width",ft).attr("height",F).attr("stroke-width",0).attr("fill",a.color),t=ft+mt;o+=t;let u=d.appendText(i,o,e,a.name),v=d.textBoundingClientRect(u);f===0&&(f=v.height);let y=v.width;o+y>h&&(e+=v.height,f+=v.height,r.attr("x",l).attr("y",e-F),o=l+t,u.attr("x",o).attr("y",e)),o+=y+I}for(let a of p.lines){let r=(qe-a.width)/2,t=i.append("line").attr("x1",o).attr("y1",e-r).attr("x2",o+Vt).attr("y2",e-r).attr("stroke-width",a.width).attr("stroke",a.color).attr("stroke-dasharray",a.dash).attr("fill","none"),u=Vt+mt;o+=u;let v=d.appendText(i,o,e,a.name),y=d.textBoundingClientRect(v);f===0&&(f=y.height);let w=y.width;o+w>h&&(e+=y.height,f+=y.height,t.attr("x1",l).attr("y1",e-r).attr("x2",l+Vt).attr("y2",e-r),o=l+u,v.attr("x",o).attr("y",e)),o+=w+I}return f}static firstTime(i){let e=i.ohlcv.data[0].time;for(let n of i.pricePane.bands){let h=n.data[0].time;e>h&&(e=h)}for(let n of i.pricePane.lines){let h=n.data[0].time;e>h&&(e=h)}for(let n of i.indicatorPanes){for(let l of n.bands){let p=l.data[0].time;e>p&&(e=p)}for(let l of n.lines){let p=l.data[0].time;e>p&&(e=p)}}return e}static lastTime(i){let e=i.ohlcv.data[i.ohlcv.data.length-1].time;for(let n of i.pricePane.bands){let l=n.data,h=l[l.length-1].time;e<h&&(e=h)}for(let n of i.pricePane.lines){let l=n.data,h=l[l.length-1].time;e<h&&(e=h)}for(let n of i.indicatorPanes){for(let l of n.bands){let h=l.data,p=h[h.length-1].time;e<p&&(e=p)}for(let l of n.lines){let h=l.data,p=h[h.length-1].time;e<p&&(e=p)}}return new Date(e.getFullYear(),e.getMonth(),e.getDay()+10)}static appendText(i,e,n,l){return i.append("text").attr("font-size","10px").attr("font-family","sans-serif").attr("x",e).attr("y",n).text(l)}static estimateNumberOfVerticalTicks(i){return i/Xe}static createPricePane(i,e,n,l,h,p,s,o,f,a){let r=i.pricePane,t=new ct;t.yPrice=E().range([n.pricePane.height,0]);let u=r.valueMarginPercentageFactor;t.yMarginFactorTop=1+u,t.yMarginFactorBottom=1-u,t.priceShape=(s?C.plot.candlestick():C.plot.ohlc()).xScale(l).yScale(t.yPrice),t.priceAccessor=t.priceShape.accessor();let v="price-clip-"+a,y=`url(#${v})`;t.group=p.append("g").attr("class","price-pane").attr("transform",`translate(${e.content.left}, ${n.pricePane.top})`),t.group.append("clipPath").attr("id",v).append("rect").attr("x",0).attr("y",t.yPrice(1)).attr("width",e.content.width).attr("height",t.yPrice(0)-t.yPrice(1));for(let c=0;c<r.bands.length;++c){let m=r.bands[c],g=new G;g.path=t.group.append("g").attr("class",`band-${c}`).attr("clip-path",y).append("path").attr("fill",m.color),g.area=D().curve(d.convertInterpolation(m.interpolation)).defined(x=>{let P=x;return!isNaN(P.lower)&&!isNaN(P.upper)}).x(x=>l(x.time)).y0(x=>{let P=x;return t.yPrice(P.lower)}).y1(x=>{let P=x;return t.yPrice(P.upper)}),g.data=m.data,t.indicatorBands.push(g)}for(let c=0;c<r.lineAreas.length;++c){let m=r.lineAreas[c],g=m.value,x=new Y;x.path=t.group.append("g").attr("class",`linearea-${c}`).attr("clip-path",y).append("path").attr("fill",m.color),x.area=D().curve(d.convertInterpolation(m.interpolation)).defined(P=>!isNaN(P.value)).x(P=>l(P.time)).y0(P=>{let z=P;return t.yPrice(z.value)}).y1(()=>t.yPrice(g)),x.data=m.data,x.value=m.value,t.indicatorLineAreas.push(x)}for(let c=0;c<r.horizontals.length;++c){let m=r.horizontals[c],g=new U;g.path=t.group.append("g").attr("class",`horizontal-${c}`).attr("clip-path",y).append("path").attr("stroke",m.color).attr("stroke-width",m.width).attr("stroke-dasharray",m.dash).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("fill","none");let x=m.value;g.value=x,g.data=[new V({time:He,value:x}),new V({time:Oe,value:x})],g.line=$().x(P=>l(P.time)).y(()=>t.yPrice(x)),t.indicatorHorizontals.push(g)}for(let c=0;c<r.lines.length;++c){let m=r.lines[c],g=new j;g.path=t.group.append("g").attr("class",`line-${c}`).attr("clip-path",y).append("path").attr("stroke",m.color).attr("stroke-width",m.width).attr("stroke-dasharray",m.dash).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("fill","none"),g.line=$().curve(d.convertInterpolation(m.interpolation)).defined(x=>!isNaN(x.value)).x(x=>l(x.time)).y(x=>{let P=x;return t.yPrice(P.value)}),g.data=m.data,t.indicatorLines.push(g)}t.groupPrice=t.group.append("g").attr("class","price").attr("clip-path",y),o&&(t.yVolume=E().range([t.yPrice(0),t.yPrice(.3)]),t.volume=C.plot.volume().xScale(l).yScale(t.yVolume),t.groupVolume=t.group.append("g").attr("class","volume").attr("clip-path",y));let w;for(let c of r.arrows){w||(w=t.group.append("g").attr("class","arrows").attr("clip-path",y));let m=new nt;m.isDown=c.down,m.path=w.append("path").attr("stroke-width",0).attr("fill",c.color);let g=d.getArrowPrice(i.ohlcv.data,c);m.price=g,m.arrow=C.shapes.arrow().orient(c.down?"down":"up").x(()=>l(c.time)).y(()=>{let x=t.yPrice(g);return c.down?x-3:x+3}),t.indicatorArrows.push(m)}if(i.axisLeft&&(t.yAxisLeft=kt(t.yPrice).tickSizeOuter(0).tickFormat(k(r.valueFormat)),r.valueTicks?t.yAxisLeft.ticks(r.valueTicks):t.yAxisLeft.ticks(d.estimateNumberOfVerticalTicks(n.pricePane.height)),t.groupAxisLeft=t.group.append("g").attr("class","y axis left")),i.axisRight&&(t.yAxisRight=bt(t.yPrice).tickSizeOuter(0).tickFormat(k(r.valueFormat)),r.valueTicks?t.yAxisRight.ticks(r.valueTicks):t.yAxisRight.ticks(d.estimateNumberOfVerticalTicks(n.pricePane.height)),t.groupAxisRight=t.group.append("g").attr("class","y axis right").attr("transform",`translate(${e.content.width}, 0)`)),f){let c=C.plot.crosshair().xScale(l).yScale(t.yPrice).xAnnotation(h).verticalWireRange([0,n.timeAxis.top]);if(i.axisLeft&&i.axisRight){let m=C.plot.axisannotation().axis(t.yAxisLeft).orient("left").format(k(r.valueFormat)),g=C.plot.axisannotation().axis(t.yAxisRight).orient("right").format(k(r.valueFormat)).translate([l(1),0]);c=c.yAnnotation([m,g])}else if(i.axisLeft){let m=C.plot.axisannotation().axis(t.yAxisLeft).orient("left").format(k(r.valueFormat));c=c.yAnnotation(m)}else if(i.axisRight){let m=C.plot.axisannotation().axis(t.yAxisRight).orient("right").format(k(r.valueFormat)).translate([l(1),0]);c=c.yAnnotation(m)}t.group.append("g").attr("class","crosshair").call(c)}return t}static createIndicatorPane(i,e,n,l,h,p,s,o,f){let a=l.indicatorPanes[i],r=e.indicatorPanes[i],t=new ot;t.yValue=E().range([a.height,0]);let u=r.valueMarginPercentageFactor;t.yMarginFactorTop=1+u,t.yMarginFactorBottom=1-u;let v=`indicator-clip-${i}-${f}`,y=`url(#${v})`;if(t.group=s.append("g").attr("class","indicator-pane").attr("transform",`translate(${n.content.left}, ${a.top})`),t.group.append("clipPath").attr("id",v).append("rect").attr("x",0).attr("y",t.yValue(1)).attr("width",n.content.width).attr("height",t.yValue(0)-t.yValue(1)),r.heatmap){let w=r.heatmap,c=new rt;c.path=t.group.append("g").attr("class","heatmap").attr("clip-path",y),c.invertGradient=w.invertGradient,c.gradient=d.convertGradient(w.gradient),c.data=w.data,c.height=a.height,t.indicatorHeatmap=c}for(let w=0;w<r.bands.length;++w){let c=r.bands[w],m=new G;m.path=t.group.append("g").attr("class",`band-${w}`).attr("clip-path",y).append("path").attr("fill",c.color),m.area=D().curve(d.convertInterpolation(c.interpolation)).defined(g=>{let x=g;return!isNaN(x.lower)&&!isNaN(x.upper)}).x(g=>h(g.time)).y0(g=>{let x=g;return t.yValue(x.lower)}).y1(g=>{let x=g;return t.yValue(x.upper)}),m.data=c.data,t.indicatorBands.push(m)}for(let w=0;w<r.lineAreas.length;++w){let c=r.lineAreas[w],m=c.value,g=new Y;g.path=t.group.append("g").attr("class",`linearea-${w}`).attr("clip-path",y).append("path").attr("fill",c.color),g.area=D().curve(d.convertInterpolation(c.interpolation)).defined(x=>!isNaN(x.value)).x(x=>h(x.time)).y0(x=>{let P=x;return t.yValue(P.value)}).y1(()=>t.yValue(m)),g.data=c.data,g.value=c.value,t.indicatorLineAreas.push(g)}for(let w=0;w<r.horizontals.length;++w){let c=r.horizontals[w],m=new U;m.path=t.group.append("g").attr("class",`horizontal-${w}`).attr("clip-path",y).append("path").attr("stroke",c.color).attr("stroke-width",c.width).attr("stroke-dasharray",c.dash).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("fill","none");let g=c.value;m.value=g,m.data=[new V({time:He,value:g}),new V({time:Oe,value:g})],m.line=$().x(x=>h(x.time)).y(()=>t.yValue(g)),t.indicatorHorizontals.push(m)}for(let w=0;w<r.lines.length;++w){let c=r.lines[w],m=new j;m.path=t.group.append("g").attr("class",`line-${w}`).attr("clip-path",y).append("path").attr("stroke",c.color).attr("stroke-width",c.width).attr("stroke-dasharray",c.dash).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("fill","none"),m.line=$().curve(d.convertInterpolation(c.interpolation)).defined(g=>!isNaN(g.value)).x(g=>h(g.time)).y(g=>{let x=g;return t.yValue(x.value)}),m.data=c.data,t.indicatorLines.push(m)}if(e.axisLeft&&(t.yAxisLeft=kt(t.yValue).tickSizeOuter(0).tickFormat(k(r.valueFormat)),r.valueTicks?t.yAxisLeft.ticks(r.valueTicks):t.yAxisLeft.ticks(d.estimateNumberOfVerticalTicks(a.height)),t.groupAxisLeft=t.group.append("g").attr("class","y axis left")),e.axisRight&&(t.yAxisRight=bt(t.yValue).tickSizeOuter(0).tickFormat(k(r.valueFormat)),r.valueTicks?t.yAxisRight.ticks(r.valueTicks):t.yAxisRight.ticks(d.estimateNumberOfVerticalTicks(a.height)),t.groupAxisRight=t.group.append("g").attr("class","y axis right").attr("transform",`translate(${n.content.width}, 0)`)),o){let w=l.timeAxis.top-a.top,c=C.plot.axisannotation().axis(p).orient("bottom").width(65).translate([0,w]);e.timeAnnotationFormat&&c.format(W(e.timeAnnotationFormat));let m=C.plot.crosshair().xScale(h).yScale(t.yValue).xAnnotation(c).verticalWireRange([l.pricePane.top-a.top,w]);if(e.axisLeft&&e.axisRight){let g=C.plot.axisannotation().axis(t.yAxisLeft).orient("left").format(k(r.valueFormat)),x=C.plot.axisannotation().axis(t.yAxisRight).orient("right").format(k(r.valueFormat)).translate([h(1),0]);m=m.yAnnotation([g,x])}else if(e.axisLeft){let g=C.plot.axisannotation().axis(t.yAxisLeft).orient("left").format(k(r.valueFormat));m=m.yAnnotation(g)}else if(e.axisRight){let g=C.plot.axisannotation().axis(t.yAxisRight).orient("right").format(k(r.valueFormat)).translate([h(1),0]);m=m.yAnnotation(g)}t.group.append("g").attr("class","crosshair").call(m)}return t}static createNavPane(i,e,n,l){let h=e.content.width,p=n.navigationPane.height,s=new st;if(i.navigationPane!==void 0){let o=i.navigationPane,f=o.hasTimeAxis?p-pt:p;s.timeScale=C.scale.financetime().range([0,h]),s.priceScale=E().range([f,0]),s.brush=qt().extent([[0,0],[h,f]]),o.hasArea&&(s.area=C.plot.ohlcarea().xScale(s.timeScale).yScale(s.priceScale)),o.hasLine&&(s.line=C.plot.closeline().xScale(s.timeScale).yScale(s.priceScale)),o.hasTimeAxis&&(s.timeAxis=Ct(s.timeScale).tickSizeOuter(0),o.timeTicksFormat!==void 0&&s.timeAxis.tickFormat(W(o.timeTicksFormat)),o.timeTicks!==void 0?s.timeAxis.ticks(o.timeTicks):s.timeAxis.ticks(e.content.width/Ne)),s.group=l.append("g").attr("class","nav").attr("transform",`translate(${e.content.left}, ${n.navigationPane.top})`).attr("height",p),o.hasArea&&(s.areaSelection=s.group.append("g").attr("class","area").attr("height",f)),o.hasLine&&(s.lineSelection=s.group.append("g").attr("class","line").attr("fill","none").attr("stroke-width",.5).attr("height",f)),s.paneSelection=s.group.append("g").attr("class","pane").attr("height",f),o.hasTimeAxis&&(s.timeAxisSelection=s.group.append("g").attr("class","x axis").attr("height",pt).attr("transform",`translate(0, ${f})`))}return s}static createTimePane(i,e,n,l){let h=new ht;return h.timeScale=C.scale.financetime().range([0,e.content.width]),h.timeAxis=Ct(h.timeScale).tickSizeOuter(0),i.timeTicksFormat!==void 0&&h.timeAxis.tickFormat(W(i.timeTicksFormat)),i.timeTicks!==void 0?h.timeAxis.ticks(i.timeTicks):h.timeAxis.ticks(e.content.width/Ne),h.timeAnnotation=C.plot.axisannotation().axis(h.timeAxis).orient("bottom").width(65).translate([0,n.timeAxis.top-n.pricePane.top]),i.timeAnnotationFormat!==void 0&&h.timeAnnotation.format(W(i.timeAnnotationFormat)),h.group=l.append("g").attr("class","x axis").attr("height",n.timeAxis.height).attr("transform",`translate(${e.content.left}, ${n.timeAxis.top})`),h}static convertInterpolation(i){switch(i.toLowerCase()){case"step":return ke;case"stepbefore":return Me;case"stepafter":return Le;case"natural":return Ce;case"basis":return Ae;case"catmullrom":return be;case"cardinal":return Pe;default:return ye}}static findOhlcv(i,e){for(let n of i)if(+n.time>=+e)return n;return null}static getArrowPrice(i,e){if(e.value)return+e.value;let n=d.findOhlcv(i,e.time);return n!=null?e.down?n.high:n.low:0}static ramp(i,e,n,l){let h=document.createElement("canvas");h.width=n,h.height=l,h.style.width=n+"px",h.style.height=l+"px",h.style.imageRendering="pixelated";let p=h.getContext("2d"),s=1/(n-1);for(let o=0;o<n;++o)p.fillStyle=i(e?1-o*s:o*s),p.fillRect(o,0,1,l);return h}static convertGradient(i){switch(i.toLowerCase()){case"viridis":return ge;case"inferno":return ve;case"magma":return xe;case"plasma":return we;case"warm":return me;case"cool":return ue;case"rainbow":return fe;case"cubehelixdefault":return pe;case"bugn":return Xt;case"bupu":return Jt;case"gnbu":return Kt;case"orrd":return Qt;case"pubugn":return Zt;case"pubu":return te;case"purd":return ee;case"rdpu":return ie;case"ylgnbu":return ae;case"ylgn":return ne;case"ylorbr":return re;case"ylorrd":return oe;case"blues":return se;case"greens":return ce;case"greys":return Mt;case"oranges":return de;case"purples":return le;case"reds":return he;default:return Mt}}get viewMenu(){return this.config?this.config.menuVisible:!1}get viewDownloadSvg(){return this.config?this.config.downloadSvgVisible:!1}get ohlcvViewType(){return this.ohlcvView}set ohlcvViewType(i){this.ohlcvView=i,this.render()}get viewCrosshair(){return this.renderCrosshair}set viewCrosshair(i){this.renderCrosshair=i,this.render()}get viewVolume(){return this.renderVolume}set viewVolume(i){this.renderVolume=i,this.render()}get chartTitle(){return this.config?this.config.ohlcv.name:"---"}constructor(){this.document=N(Tt),this.platformId=N(Rt),this.random=Math.random().toString(36).substring(2),this.svgContainerId="ohlcv-chart-svg-"+this.random,this.widthContainerId="ohlcv-chart-width-"+this.random,this.currentSelection=null,this.ohlcvViewCandlesticks=dt,this.ohlcvViewBars=Lt,this.configuration=Ot.required(),Ht(()=>{let n=this.configuration();n&&n!=null?(this.config=n,this.ohlcvView=n.ohlcv.candlesticks?dt:Lt,this.renderCrosshair=n.crosshair,this.renderVolume=n.volumeInPricePane,this.currentSelection=null):this.config=new et,this.render()});let i=N(Ut),e=N(Et);i.addSvgIcon("mb-candlesticks",e.bypassSecurityTrustResourceUrl("assets/mb/mb-candlesticks.svg")),i.addSvgIcon("mb-bars",e.bypassSecurityTrustResourceUrl("assets/mb/mb-bars.svg")),this.renderVolume=this.config?this.config.volumeInPricePane:!0,this.renderCrosshair=this.config?this.config.crosshair:!0,this.ohlcvView=this.config&&!this.config.ohlcv.candlesticks?Lt:dt,Ft({write:()=>{this.render()}})}downloadSvg(){let i=new Date,e=`olcv-chart_${i.getFullYear()}-${i.getMonth()}-${i.getDay()}_${i.getHours()}-${i.getMinutes()}-${i.getSeconds()}.html`,n=X("#"+this.widthContainerId).node();J.download(J.serializeToSvg(J.getChildElementById(n.parentNode,this.svgContainerId),Je,Ke),e)}render(){if(!_t(this.platformId)||!this.document||this.document===null)return;let i=this.config;if(!i||!i.width)return;let e=this.random,n=X("#"+this.widthContainerId).node();if(!n||n===null)return;let l=n.offsetWidth,h=d.layoutHorizontal(i,l),p=X("#"+this.svgContainerId);p.select("svg").remove();let s=p.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",h.width),o=d.layoutVertical(s,i,h);s.attr("height",o.height).attr("viewBox",`0 0 ${h.width} ${o.height}`);let f=d.createTimePane(i,h,o,s),a=d.createPricePane(i,h,o,f.timeScale,f.timeAnnotation,s,this.ohlcvView===dt,this.renderVolume,this.renderCrosshair,e),r=[];for(let c=0;c<i.indicatorPanes.length;++c){let m=d.createIndicatorPane(c,i,h,o,f.timeScale,f.timeAxis,s,this.renderCrosshair,e);r.push(m)}let t=d.createNavPane(i,h,o,s);function u(){f.draw(),a.draw(f),r.forEach(c=>c.draw(f,a))}let v=c=>{this.currentSelection=c};function y(c){let m=f.timeScale.zoomable(),g=t.timeScale.zoomable();m.domain(g.domain()),c.selection?(v(c.selection),m.domain(c.selection.map(m.invert)),_e||u()):(v(null),u())}function w(c){if(c.selection){let m=c.selection;if(m[1]-m[0]>ze){let g=f.timeScale.zoomable(),x=t.timeScale.zoomable();g.domain(x.domain()),g.domain(c.selection.map(g.invert)),u()}}}if(_e&&t.brush.on("brush",w),t.brush.on("end",y),f.timeScale.domain(i.ohlcv.data.map(a.priceAccessor.time)),t.timeScale.domain(f.timeScale.domain()),a.yPrice.domain(C.scale.plot.ohlc(i.ohlcv.data,a.priceAccessor).domain()),t.priceScale.domain(a.yPrice.domain()),a.yVolume&&a.yVolume.domain(C.scale.plot.volume(i.ohlcv.data).domain()),a.groupPrice.datum(i.ohlcv.data),this.renderVolume&&a.groupVolume.datum(i.ohlcv.data),a.setIndicatorDatum(),r.forEach(c=>c.setIndicatorDatum()),t.area&&t.areaSelection.datum(i.ohlcv.data).call(t.area),t.line&&t.lineSelection.datum(i.ohlcv.data).call(t.line),t.timeAxis&&t.timeAxisSelection.call(t.timeAxis),t.paneSelection.call(t.brush).selectAll("rect").attr("height",o.navigationPane.height),this.currentSelection!=null&&this.currentSelection[1]-this.currentSelection[0]>ze){t.brush.move(t.paneSelection,this.currentSelection);let c=f.timeScale.zoomable(),m=t.timeScale.zoomable();c.domain(m.domain()),c.domain(this.currentSelection.map(c.invert))}u()}};d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=It({type:d,selectors:[["mb-ohlcv-chart"]],hostBindings:function(e,n){e&1&&q("resize",function(){return n.render()},Bt)},inputs:{configuration:[1,"configuration"]},decls:3,vars:5,consts:[["group1","matButtonToggleGroup"],[1,"container",3,"id"],["expanded","false"],[3,"id"],[1,"button-toggle-group",3,"change","value"],[3,"value"],["svgIcon","mb-candlesticks",1,"svg-icon"],["svgIcon","mb-bars",1,"svg-icon"],[1,"slide-toggle",3,"ngModelChange","ngModel"],["mat-mini-fab","","color","accent",1,"download"],["mat-mini-fab","","color","accent",1,"download",3,"click"]],template:function(e,n){e&1&&(_(0,"div",1),gt(1,je,19,7,"mat-expansion-panel",2),_(2,"div",3)),e&2&&(T("id",Pt(n.widthContainerId)),L(),xt(n.viewMenu?1:-1),L(),T("id",Pt(n.svgContainerId)))},dependencies:[Dt,Wt,$t,Yt,Gt,Ve,Se,jt,Te,Re,Be],styles:[".container[_ngcontent-%COMP%]{margin:0;padding:0 8px;height:1px}.button-toggle-group[_ngcontent-%COMP%]{margin:0 16px 0 0}.slide-toggle[_ngcontent-%COMP%]{margin:0 16px 0 0;vertical-align:middle}.download[_ngcontent-%COMP%]{vertical-align:middle}mat-slide-toggle[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{vertical-align:bottom}[_nghost-%COMP%]     path.candle.body{stroke-width:1px}[_nghost-%COMP%]     path.ohlc{stroke-width:1px}[_nghost-%COMP%]     .extent{fill-opacity:.125;shape-rendering:crispEdges}[_nghost-%COMP%]     .coords{font:10px sans-serif}[_nghost-%COMP%]     .crosshair{cursor:crosshair;font:10px sans-serif}[_nghost-%COMP%]     .crosshair path.wire{stroke-dasharray:1,1}"],changeDetection:0});let b=d;return b})();export{V as a,wa as b};
