import{Ic as N,Jc as v,Lc as P,Mb as T,Mc as x,Nb as $,Nc as V,Ob as A,Ya as k,ca as D,ec as L,fc as z,ib as O,ic as _,na as H,ta as S,tb as E}from"./chunk-54YCK6MI.js";var W=["canvas"],q=(()=>{let M=class M{radialSegments(t){let e=this.effectiveResolution(),n=2*Math.PI*t*e,i=Math.round(n/1.5);i=Math.max(i,360);let s=16;i=Math.round(i/s)*s;let o=Math.min(3600,n*2);return i=Math.min(i,o),Math.max(360,i)}constructor(){this.document=D(H),this.canvas=V.required("canvas"),this.layout=x("outer-hue"),this.alphaChannel=x(!1),this.diameter=x(280),this.ringWidth=x(24),this.handleSize=x(12),this.resolution=x("auto"),this.disabled=x(!1),this.hexValue=x("#ff4081"),this.backgroundColor=x("auto"),this.hexValueChange=P(),this.colorChange=P(),this.isDragging=S(!1),this.ctx=null,this.geometry=null,this.currentHsla=S([0,100,50,1]),this.dragTarget=null,this.effectiveResolution=N(()=>{let t=this.resolution();return t==="auto"?Math.min(window.devicePixelRatio||1,3):t}),this.abortController=new AbortController,this.handlePointerDown=t=>{if(this.disabled())return;t.preventDefault();let e=this.getEventCoordinates(t);this.startDragging(e)},this.handlePointerMove=t=>{if(!this.isDragging()||this.disabled()||this.abortController.signal.aborted)return;t.preventDefault();let e=this.getEventCoordinates(t);this.updateColor(e)},this.handlePointerUp=()=>{this.abortController.signal.aborted||this.stopDragging()},this.handleTouchStart=t=>{if(this.disabled())return;t.preventDefault();let e=t.touches[0],n=this.getTouchCoordinates(e);this.startDragging(n)},this.handleTouchMove=t=>{if(!this.isDragging()||this.disabled()||this.abortController.signal.aborted)return;t.preventDefault();let e=t.touches[0],n=this.getTouchCoordinates(e);this.updateColor(n)},this.handleTouchEnd=t=>{this.abortController.signal.aborted||(t.preventDefault(),this.stopDragging())},this.preventContextMenu=t=>{t.preventDefault()},E(()=>{this.initializeCanvas()}),v(()=>{let t=this.hexValue();if(this.isValidHex(t)||this.isValidHexa(t)){let e=this.hexToHsla(t);this.currentHsla.set(e),this.scheduleRender()}}),v(()=>{this.diameter(),this.ringWidth(),this.handleSize(),this.effectiveResolution(),this.alphaChannel(),this.updateCanvasSize()}),v(()=>{this.currentHsla(),this.layout(),this.scheduleRender()})}ngOnDestroy(){this.abortController.abort()}initializeCanvas(){let t=this.canvas().nativeElement;this.ctx=t.getContext("2d",{alpha:!0}),this.updateCanvasSize(),this.attachEventListeners()}updateCanvasSize(){if(!this.ctx)return;let t=this.canvas().nativeElement,e=this.diameter(),n=this.effectiveResolution(),r=e*n;t.width=r,t.height=r,t.style.width=`${e}px`,t.style.height=`${e}px`,this.ctx.scale(n,n),this.ctx.imageSmoothingEnabled=!0;let i=e/2,s=this.ringWidth(),o=this.handleSize()/2,l=4;if(this.alphaChannel()){let a=i-l,c=i-s-l,h=c-l,d=h-Math.round(s*.7),g=d-l;this.geometry={center:{x:i,y:i},wheelRadius:g,middleRingInnerRadius:d,middleRingOuterRadius:h,outerRingInnerRadius:c,outerRingOuterRadius:a,handleRadius:o}}else{let a=i-l,c=i-s-l,h=c-o-l;this.geometry={center:{x:i,y:i},wheelRadius:h,middleRingInnerRadius:0,middleRingOuterRadius:0,outerRingInnerRadius:c,outerRingOuterRadius:a,handleRadius:o}}this.scheduleRender()}scheduleRender(){requestAnimationFrame(()=>this.render())}getEffectiveBackgroundColor(){let t=this.backgroundColor();if(t==="auto"){let e=this.isDarkMode(),r=getComputedStyle(this.canvas().nativeElement).getPropertyValue("--mat-sys-surface").trim();return r?this.extractColorFromLightDark(r,e):e?"#121212":"#ffffff"}return this.resolveCssVariables(t)}extractColorFromLightDark(t,e){let n=t.match(/light-dark\(\s*([^,]+),\s*([^)]+)\s*\)/);if(n){let r=n[1].trim(),i=n[2].trim();return e?i:r}return t}isDarkMode(){let e=getComputedStyle(this.document.documentElement).getPropertyValue("color-scheme").trim();return e.includes("dark")?!0:e.includes("light")?!1:this.document.documentElement.classList.contains("dark-theme")||this.document.documentElement.classList.contains("dark")||this.document.body.classList.contains("dark-theme")||this.document.body.classList.contains("dark")?!0:typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches:(this.document.documentElement.getAttribute("data-theme")||this.document.documentElement.getAttribute("theme"))==="dark"}resolveCssVariables(t){if(!t.includes("var("))return t;try{let e=this.canvas().nativeElement,n=e.style.backgroundColor;e.style.backgroundColor=t;let i=getComputedStyle(e).backgroundColor;return e.style.backgroundColor=n,this.convertToHex(i)||i}catch(e){return console.warn("Failed to resolve CSS variable:",t,e),t}}convertToHex(t){let e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(e){let n=parseInt(e[1],10),r=parseInt(e[2],10),i=parseInt(e[3],10),s=o=>{let l=o.toString(16);return l.length===1?"0"+l:l};return`#${s(n)}${s(r)}${s(i)}`}return t}render(){if(!this.ctx||!this.geometry)return;let t=this.canvas().nativeElement,e=this.getEffectiveBackgroundColor(),n=this.effectiveResolution();e==="transparent"?this.ctx.clearRect(0,0,t.width/n,t.height/n):(this.ctx.fillStyle=e,this.ctx.fillRect(0,0,t.width/n,t.height/n)),this.layout()==="outer-lightness"?(this.renderInnerSaturationHueColorWheel(),this.renderOuterLightnessRing()):(this.renderInnerSaturationLightnessColorWheel(),this.renderOuterHueRing()),this.alphaChannel()&&this.renderMiddleAlphaRing(),this.renderHandles()}renderMiddleAlphaRing(){if(!this.ctx||!this.geometry)return;let{center:t,middleRingInnerRadius:e,middleRingOuterRadius:n}=this.geometry,[r,i,s]=this.currentHsla();this.drawCheckerboardInRing(t,e,n);let o=this.radialSegments(n),l=2*Math.PI/o;for(let a=0;a<o;a++){let c=a/o,h=l*a,d=l*(a+1);this.ctx.fillStyle=`hsla(${r}, ${i}%, ${s}%, ${c})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,n,h,d),this.ctx.arc(t.x,t.y,e,d,h,!0),this.ctx.closePath(),this.ctx.fill()}}drawCheckerboardInRing(t,e,n){if(!this.ctx)return;let r=document.createElement("canvas"),i=r.getContext("2d"),s=8;r.width=s*2,r.height=s*2,i.fillStyle="#f0f0f0",i.fillRect(0,0,s,s),i.fillRect(s,s,s,s),i.fillStyle="#d0d0d0",i.fillRect(s,0,s,s),i.fillRect(0,s,s,s);let o=this.ctx.createPattern(r,"repeat");this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,n,0,Math.PI*2),this.ctx.arc(t.x,t.y,e,0,Math.PI*2,!0),this.ctx.fillStyle=o,this.ctx.fill(),this.ctx.restore()}renderInnerSaturationHueColorWheel(){if(!this.ctx||!this.geometry)return;let{center:t,wheelRadius:e}=this.geometry,n=this.radialSegments(e),r=2*Math.PI/n,i=360/n;for(let s=0;s<n;s++){let o=i*s,l=r*s,a=r*(s+1),c=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,e);c.addColorStop(0,`hsl(${o}, 0%, 50%)`),c.addColorStop(1,`hsl(${o}, 100%, 50%)`),this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.arc(t.x,t.y,e,l,a),this.ctx.closePath(),this.ctx.fill()}}renderOuterLightnessRing(){if(!this.ctx||!this.geometry)return;let{center:t,outerRingInnerRadius:e,outerRingOuterRadius:n}=this.geometry,[r,i]=this.currentHsla(),s=this.radialSegments(n),o=2*Math.PI/s,l=100/s;for(let a=0;a<s;a++){let c=l*a,h=o*a,d=o*(a+1);this.ctx.fillStyle=`hsl(${r}, ${i}%, ${c}%)`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,n,h,d),this.ctx.arc(t.x,t.y,e,d,h,!0),this.ctx.closePath(),this.ctx.fill()}}renderOuterHueRing(){if(!this.ctx||!this.geometry)return;let{center:t,outerRingInnerRadius:e,outerRingOuterRadius:n}=this.geometry,[,r,i]=this.currentHsla(),s=this.radialSegments(n),o=2*Math.PI/s,l=360/s;for(let a=0;a<s;a++){let c=a*o,h=(a+1)*o,d=l*a,g=this.ctx.createRadialGradient(t.x,t.y,e,t.x,t.y,n);g.addColorStop(0,`hsl(${d}, ${r}%, ${i}%)`),g.addColorStop(1,`hsl(${d}, ${r}%, ${i}%)`),this.ctx.fillStyle=g,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,n,c,h),this.ctx.arc(t.x,t.y,e,h,c,!0),this.ctx.closePath(),this.ctx.fill()}}renderInnerSaturationLightnessColorWheel(){if(!this.ctx||!this.geometry)return;let{center:t,wheelRadius:e}=this.geometry,[n]=this.currentHsla();this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.beginPath(),this.ctx.arc(0,0,e,0,Math.PI*2),this.ctx.clip(),this.ctx.closePath();let r=this.ctx.createLinearGradient(0,-e,0,e);r.addColorStop(0,"white"),r.addColorStop(1,"black");let i=this.ctx.createLinearGradient(-e,0,e,0);i.addColorStop(0,`hsla(${n}, 100%, 50%, 0)`),i.addColorStop(1,`hsla(${n}, 100%, 50%, 1)`),this.ctx.fillStyle=r,this.ctx.fill(),this.ctx.globalCompositeOperation="multiply",this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.globalCompositeOperation="source-over",this.ctx.restore()}renderHandles(){if(!this.ctx||!this.geometry)return;let{center:t,wheelRadius:e,middleRingInnerRadius:n,middleRingOuterRadius:r,outerRingInnerRadius:i,outerRingOuterRadius:s,handleRadius:o}=this.geometry,[l,a,c,h]=this.currentHsla(),d=this.layout(),g,p,u,b;if(d==="outer-lightness"){let m=l*Math.PI/180,f=a/100*e;g=t.x+Math.cos(m)*f,p=t.y+Math.sin(m)*f;let C=c/100*2*Math.PI,y=(i+s)/2;u=t.x+Math.cos(C)*y,b=t.y+Math.sin(C)*y}else{let m=(a/100*2-1)*e,f=((1-c/100)*2-1)*e,C=Math.sqrt(m*m+f*f);if(C>e){let w=e/C;g=t.x+m*w,p=t.y+f*w}else g=t.x+m,p=t.y+f;let y=l/360*2*Math.PI,I=(i+s)/2;u=t.x+Math.cos(y)*I,b=t.y+Math.sin(y)*I}if(this.alphaChannel()){let m=h*2*Math.PI,f=(n+r)/2,C=t.x+Math.cos(m)*f,y=t.y+Math.sin(m)*f;this.drawHandle(C,y,o,"#ffffff","#333333")}this.drawHandle(g,p,o,"#ffffff","#333333"),this.drawHandle(u,b,o,"#ffffff","#333333")}drawHandle(t,e,n,r,i){this.ctx&&(this.ctx.fillStyle=r,this.ctx.strokeStyle=i,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t,e,n,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke())}attachEventListeners(){let t=this.canvas().nativeElement,e=this.abortController.signal;t.addEventListener("mousedown",this.handlePointerDown,{signal:e}),document.addEventListener("mousemove",this.handlePointerMove,{signal:e}),document.addEventListener("mouseup",this.handlePointerUp,{signal:e}),t.addEventListener("touchstart",this.handleTouchStart,{signal:e}),document.addEventListener("touchmove",this.handleTouchMove,{signal:e}),document.addEventListener("touchend",this.handleTouchEnd,{signal:e}),t.addEventListener("contextmenu",this.preventContextMenu,{signal:e})}getEventCoordinates(t){let e=this.canvas().nativeElement.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}getTouchCoordinates(t){let e=this.canvas().nativeElement.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}startDragging(t){if(!this.geometry)return;let{center:e,wheelRadius:n,middleRingInnerRadius:r,middleRingOuterRadius:i,outerRingInnerRadius:s,outerRingOuterRadius:o}=this.geometry,l=t.x-e.x,a=t.y-e.y,c=Math.sqrt(l*l+a*a);if(c<=n+8)this.dragTarget="wheel";else if(this.alphaChannel()&&c>=r-8&&c<=i+8)this.dragTarget="middle-ring";else if(c>=s-8&&c<=o+8)this.dragTarget="outer-ring";else return;this.isDragging.set(!0),this.updateColor(t)}updateColor(t){if(!this.geometry||!this.dragTarget||this.abortController.signal.aborted)return;let{center:e}=this.geometry,n=t.x-e.x,r=t.y-e.y,i=Math.sqrt(n*n+r*r),s=Math.atan2(r,n),o=this.geometry.wheelRadius,[l,a,c,h]=this.currentHsla(),d=this.layout();if(this.dragTarget==="wheel"){if(d==="outer-lightness")l=(s*180/Math.PI+360)%360,a=Math.min(100,i/o*100);else if(i<=o){let u=2*o;a=Math.max(0,Math.min(100,(n+o)/u*100)),c=Math.max(0,Math.min(100,(1-(r+o)/u)*100))}}else if(this.dragTarget==="middle-ring"){let u=s;u<0&&(u+=2*Math.PI),h=u/(2*Math.PI)}else if(this.dragTarget==="outer-ring"){let u=s;u<0&&(u+=2*Math.PI),d==="outer-lightness"?c=Math.max(0,Math.min(100,u/(2*Math.PI)*100)):l=u/(2*Math.PI)*360}let g=[l,a,c,h];this.currentHsla.set(g);let p=this.generateHexOutput(g);this.abortController.signal.aborted||(this.hexValueChange.emit(p),this.colorChange.emit({hex:p,hsl:[l,a,c],alpha:h}))}stopDragging(){this.isDragging.set(!1),this.dragTarget=null}isValidHex(t){let e=/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(t),n=this.alphaChannel()?this.isValidHexa(t):!1;return e||n}isValidHexa(t){return/^#([0-9A-Fa-f]{8})$/.test(t)}hexToHsla(t){t=t.replace("#","");let e,n,r,i=1;if(t.length===3)e=parseInt(t[0]+t[0],16),n=parseInt(t[1]+t[1],16),r=parseInt(t[2]+t[2],16);else if(t.length===6)e=parseInt(t.slice(0,2),16),n=parseInt(t.slice(2,4),16),r=parseInt(t.slice(4,6),16);else if(t.length===8)e=parseInt(t.slice(0,2),16),n=parseInt(t.slice(2,4),16),r=parseInt(t.slice(4,6),16),i=parseInt(t.slice(6,8),16)/255;else return[0,0,0,1];let[s,o,l]=this.rgbToHsl([e,n,r]);return[s,o,l,i]}generateHexOutput([t,e,n,r]){if(!this.alphaChannel()||r===1)return this.hslToHex([t,e,n]);let i=this.hslToRgb([t,e,n]),s=Math.round(r*255).toString(16).padStart(2,"0");return`#${i.map(l=>Math.round(l).toString(16).padStart(2,"0")).join("")}${s}`}rgbToHsl([t,e,n]){t/=255,e/=255,n/=255;let r=Math.max(t,e,n),i=Math.min(t,e,n),s=r-i,o=r+i,l=0,a=0,c=o/2;if(s!==0)switch(a=c>.5?s/(2-o):s/o,r){case t:l=((e-n)/s+(e<n?6:0))/6;break;case e:l=((n-t)/s+2)/6;break;case n:l=((t-e)/s+4)/6;break}return[Math.round(l*360),Math.round(a*100),Math.round(c*100)]}hslToRgb([t,e,n]){t/=360,e/=100,n/=100;let r=(1-Math.abs(2*n-1))*e,i=r*(1-Math.abs(t*6%2-1)),s=n-r/2,o=0,l=0,a=0;return 0<=t&&t<1/6?(o=r,l=i,a=0):1/6<=t&&t<2/6?(o=i,l=r,a=0):2/6<=t&&t<3/6?(o=0,l=r,a=i):3/6<=t&&t<4/6?(o=0,l=i,a=r):4/6<=t&&t<5/6?(o=i,l=0,a=r):5/6<=t&&t<1&&(o=r,l=0,a=i),[Math.round((o+s)*255),Math.round((l+s)*255),Math.round((a+s)*255)]}hslToHex([t,e,n]){t/=360,e/=100,n/=100;let r=(a,c,h)=>(h<0&&(h+=1),h>1&&(h-=1),h<1/6?a+(c-a)*6*h:h<1/2?c:h<2/3?a+(c-a)*(2/3-h)*6:a),i,s,o;if(e===0)i=s=o=n;else{let a=n<.5?n*(1+e):n+e-n*e,c=2*n-a;i=r(c,a,t+1/3),s=r(c,a,t),o=r(c,a,t-1/3)}let l=a=>{let c=Math.round(a*255).toString(16);return c.length===1?"0"+c:c};return`#${l(i)}${l(s)}${l(o)}`}};M.\u0275fac=function(e){return new(e||M)},M.\u0275cmp=O({type:M,selectors:[["mb-color-disc"]],viewQuery:function(e,n){e&1&&L(n.canvas,W,5),e&2&&z()},inputs:{layout:[1,"layout"],alphaChannel:[1,"alphaChannel"],diameter:[1,"diameter"],ringWidth:[1,"ringWidth"],handleSize:[1,"handleSize"],resolution:[1,"resolution"],disabled:[1,"disabled"],hexValue:[1,"hexValue"],backgroundColor:[1,"backgroundColor"]},outputs:{hexValueChange:"hexValueChange",colorChange:"colorChange"},decls:3,vars:2,consts:[["canvas",""],[1,"color-disc-container"]],template:function(e,n){e&1&&(T(0,"div",1),A(1,"canvas",null,0),$()),e&2&&(k(),_("dragging",n.isDragging))},styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .color-disc-container[_ngcontent-%COMP%]{display:inline-block;position:relative}[_nghost-%COMP%]   .color-disc-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block;border-radius:50%;cursor:crosshair;-webkit-user-select:none;user-select:none;touch-action:none}[_nghost-%COMP%]   .color-disc-container[_ngcontent-%COMP%]   canvas.dragging[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]   .color-disc-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]:focus{outline:2px solid var(--mat-sys-primary);outline-offset:2px}[disabled][_nghost-%COMP%]   .color-disc-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}"],changeDetection:0});let R=M;return R})();export{q as a};
