import{$ as I,C as q,a as B,d,e as T,f as A,ha as Y,i as E,k as W,l as k}from"./chunk-JEPWSQCW.js";import{a as j}from"./chunk-IEKDCRBV.js";import{Qa as P,k as R,x as $,z as L}from"./chunk-GDNQNY7K.js";import{Aa as O,Cc as i,Nb as D,Pb as H,Qb as N,Ua as S,ba as M,gb as V,xa as C}from"./chunk-OH5MFEO2.js";P();var Q=["*"],_=800,X=600,U=0,tt=750,Z="asc",et="desc",it=!1,nt=!1,ot="white",st=4,G=16,wt=(()=>{let l=class l{constructor(){this.elementRef=M(O),this.sumFunc=i(B),this.sort=i(Z),this.zoom=i(it),this.transitionMsec=i(tt),this.levels=i(U),this.labelFunc=i(E),this.labelFill=i(ot),this.labelFontSizeFunc=i(Y),this.tooltipFunc=i(W),this.tapFunc=i(k),this.fillFunc=i(q),this.fillOpacityFunc=i(I),this.width=i(_),this.height=i(X),this.data=i.required(),this.rootVisible=i(nt)}ngOnChanges(r){this.render()}render(){let r=R(this.elementRef.nativeElement);r.select("svg").remove();let o=this.data();if(!o||!o.children||o.children.length<1)return;let s=j(this.elementRef,this.width(),this.height(),_,X),p=s[0],a=s[1],J=r.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",p).attr("height",a).attr("viewBox",`0 0 ${p} ${a}`),F=this.sort(),g=F===Z?T:F===et?A:d,c=(t=>{let e=$(t).sum(this.sumFunc());g!==d&&(e=e.sort((f,n)=>g(f,n)));let u=(this.levels()<1?e.height:this.levels())+(this.rootVisible()?1:0);return L().size([s[1],(e.height+1)*s[0]/u])(e)})(o),y=c,x=this.rootVisible()?0:c.y1,h=J.selectAll("g").data(c.descendants()).join("g").attr("transform",t=>`translate(${t.y0-x},${t.x0})`),b=t=>t.x1-t.x0-Math.min(1,(t.x1-t.x0)/2),v=h.append("rect").style("cursor",t=>t.children&&t.parent?"pointer":"arrow").attr("width",t=>t.y1-t.y0-1).attr("height",t=>b(t)).attr("fill",this.fillFunc()).attr("fill-opacity",t=>this.fillOpacityFunc()(t,c.height)),z=t=>t.x1-t.x0>this.labelFontSizeFunc()(t)+G,w=h.append("text").style("user-select","none").attr("pointer-events","none").attr("x",st).attr("y",G).style("fill",this.labelFill()).attr("fill-opacity",t=>+z(t)).attr("font-size",t=>this.labelFontSizeFunc()(t));w.append("tspan").text(t=>this.labelFunc()(t)),h.append("title").text(t=>this.tooltipFunc()(t));let K=(t,e)=>{if(this.tapFunc()(e),this.zoom()&&e.children){y=y===e&&e.parent?e=e.parent:e;let u=e===c?x:0;c.each(n=>n.target={x0:(n.x0-e.x0)/(e.x1-e.x0)*a,x1:(n.x1-e.x0)/(e.x1-e.x0)*a,y0:n.y0-e.y0-u,y1:n.y1-e.y0-u});let f=h.transition().duration(this.transitionMsec()).attr("transform",n=>`translate(${n.target.y0},${n.target.x0})`);v.transition(f).attr("height",n=>b(n.target)),w.transition(f).attr("fill-opacity",n=>+z(n.target))}};v.on("click",K)}};l.\u0275fac=function(o){return new(o||l)},l.\u0275cmp=V({type:l,selectors:[["mb-icicle"]],hostBindings:function(o,s){o&1&&D("resize",function(){return s.render()},S)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],zoom:[1,"zoom"],transitionMsec:[1,"transitionMsec"],levels:[1,"levels"],labelFunc:[1,"labelFunc"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],width:[1,"width"],height:[1,"height"],data:[1,"data"],rootVisible:[1,"rootVisible"]},features:[C],ngContentSelectors:Q,decls:1,vars:0,template:function(o,s){o&1&&(H(),N(0))},encapsulation:2,changeDetection:0});let m=l;return m})();export{wt as a};
