import{$ as G,C as Z,a as V,d as g,e as q,f as I,ha as J,i as _,k as W,l as Y}from"./chunk-JEPWSQCW.js";import{a as E}from"./chunk-IEKDCRBV.js";import{Aa as k,Qa as et,k as L,q as B,x as H,z as P}from"./chunk-GDNQNY7K.js";import{Aa as D,Cc as i,Nb as $,Pb as N,Qb as j,Ua as A,ba as S,gb as T,xa as C}from"./chunk-OH5MFEO2.js";et();var nt=["*"],x=2*Math.PI,it=180/Math.PI,y=300,st=0,at=750,K="asc",rt="desc",ot=!1,lt="white",St=(()=>{let o=class o{constructor(){this.elementRef=S(D),this.sumFunc=i(V),this.sort=i(K),this.zoom=i(ot),this.transitionMsec=i(at),this.levels=i(st),this.labelFunc=i(_),this.labelFill=i(lt),this.labelFontSizeFunc=i(J),this.tooltipFunc=i(W),this.tapFunc=i(Y),this.fillFunc=i(Z),this.fillOpacityFunc=i(G),this.diameter=i(y),this.data=i.required()}ngOnChanges(l){this.render()}render(){let l=L(this.elementRef.nativeElement);l.select("svg").remove();let s=this.data();if(!s||!s.children||s.children.length<1)return;let h=E(this.elementRef,this.diameter(),this.diameter(),y,y),r=Math.max(h[0],h[1]),b=r/2,p=l.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",r).attr("height",r).attr("viewBox",`0 0 ${r} ${r}`).append("g").attr("transform",`translate(${b},${b})`),v=this.sort(),M=v===K?q:v===rt?I:g,a=(t=>{let n=H(t).sum(this.sumFunc());return M!==g&&(n=n.sort((u,e)=>M(u,e))),P().size([x,n.height+1])(n)})(s);a.each(t=>t.current=t);let d=(this.levels()<1?a.height:this.levels())+1,c=r/(2*d),z=k().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(c*1.5).innerRadius(t=>t.y0*c).outerRadius(t=>Math.max(t.y0*c,t.y1*c-1)),m=t=>t.y1<=d&&t.y0>=1&&t.x1>t.x0,F=t=>t.y1<=d&&t.y0>=1&&(t.y1-t.y0)*(t.x1-t.x0)>.05,w=t=>{let n=(t.x0+t.x1)/2*it,u=(t.y0+t.y1)/2*c;return`rotate(${n-90}) translate(${u},0) rotate(${n<180?0:180})`},O=(t,n)=>{if(this.tapFunc()(n),this.zoom()&&n.children){U.datum(n.parent||a),a.each(e=>e.target={x0:Math.max(0,Math.min(1,(e.x0-n.x0)/(n.x1-n.x0)))*x,x1:Math.max(0,Math.min(1,(e.x1-n.x0)/(n.x1-n.x0)))*x,y0:Math.max(0,e.y0-n.depth),y1:Math.max(0,e.y1-n.depth)});let u=p.transition().duration(this.transitionMsec());R.transition(u).tween("data",e=>{let X=B(e.current,e.target);return tt=>e.current=X(tt)}).filter(e=>m(e.current)||m(e.target)).attr("fill-opacity",e=>m(e.target)?this.fillOpacityFunc()(e,a.height):0).attrTween("d",e=>()=>z(e.current)),Q.filter(e=>m(e.current)||F(e.target)).transition(u).attr("fill-opacity",e=>+F(e.target)).attrTween("transform",e=>()=>w(e.current))}},R=p.append("g").selectAll("path").data(a.descendants().slice(1)).join("path").attr("fill",this.fillFunc()).attr("fill-opacity",t=>m(t.current)?this.fillOpacityFunc()(t,a.height):0).attr("d",t=>z(t.current)).on("click",O);R.append("title").text(t=>this.tooltipFunc()(t));let Q=p.append("g").attr("pointer-events","none").attr("text-anchor","middle").style("user-select","none").style("fill",this.labelFill()).selectAll("text").data(a.descendants().slice(1)).join("text").attr("font-size",t=>this.labelFontSizeFunc()(t)).attr("dy","0.35em").attr("fill-opacity",t=>+F(t.current)).attr("transform",t=>w(t.current)).text(t=>this.labelFunc()(t)),U=p.append("circle").datum(a).attr("r",c).attr("fill","none").attr("pointer-events","all").on("click",O)}};o.\u0275fac=function(s){return new(s||o)},o.\u0275cmp=T({type:o,selectors:[["mb-sunburst"]],hostBindings:function(s,h){s&1&&$("resize",function(){return h.render()},A)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],zoom:[1,"zoom"],transitionMsec:[1,"transitionMsec"],levels:[1,"levels"],labelFunc:[1,"labelFunc"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],diameter:[1,"diameter"],data:[1,"data"]},features:[C],ngContentSelectors:nt,decls:1,vars:0,template:function(s,h){s&1&&(N(),j(0))},encapsulation:2,changeDetection:0});let f=o;return f})();export{St as a};
