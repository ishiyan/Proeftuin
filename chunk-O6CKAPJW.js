import{a as Se,b as Ve,c as X}from"./chunk-2PEVT6WB.js";import{a as Te,b as Re,c as Be}from"./chunk-GIEDKP66.js";import{a as jt}from"./chunk-JVIRUAT2.js";import{g as Wt,i as $t,r as Dt}from"./chunk-P6Z6ONSU.js";import{d as Et,e as Ut,f as Yt}from"./chunk-S5VVXV6E.js";import{a as b}from"./chunk-TCPIY6ZW.js";import{c as Gt}from"./chunk-O4Z6RA3S.js";import{$ as Jt,Ba as ve,Ca as W,Da as $,Ea as ye,Fa as Ae,G as _,Ga as Pe,Ka as be,La as ke,Ma as Me,Na as Le,Qa as $e,V as E,Z as Ot,_ as Xt,aa as Kt,ba as Qt,ca as Zt,da as te,ea as ee,fa as ie,g as Pt,ga as ae,h as bt,ha as ne,i as kt,ia as re,ja as oe,k as O,ka as se,la as Mt,ma as ce,na as le,oa as de,qa as he,ra as pe,sa as ue,ta as me,v as qt,w as k,wa as fe,xa as ge,ya as xe,za as we}from"./chunk-KMPZBAPX.js";import{d as Ht,q as _t}from"./chunk-XMFNCAXR.js";import{Eb as gt,Ha as Rt,Ic as Ct,Jb as M,Kb as S,Lb as H,Na as Bt,Pb as xt,Tb as q,Ub as R,Xb as wt,_a as It,ab as L,ca as z,dc as zt,ec as B,gc as Nt,jc as vt,ka as N,kc as yt,la as C,lc as At,nb as Ft,tb as ft,za as Tt,zb as j}from"./chunk-BVFQLCWY.js";$e();var T=class{constructor(A){if(A)for(let e in A)Object.prototype.hasOwnProperty.call(A,e)&&(this[e]=A[e])}};var J=class{constructor(){this.height=30,this.hasLine=!0,this.hasArea=!1,this.hasTimeAxis=!0}};var K=class{constructor(){this.left=0,this.top=0,this.right=0,this.bottom=0}};var Q=class{constructor(){this.name="",this.data=[],this.candlesticks=!0}};var Z=class{constructor(){this.height=0,this.valueFormat=",.2f",this.valueMarginPercentageFactor=0,this.bands=[],this.lineAreas=[],this.horizontals=[],this.lines=[],this.arrows=[]}};var tt=class{constructor(){this.navigationPane=new J,this.axisLeft=!0,this.axisRight=!1,this.margin=new K,this.ohlcv=new Q,this.pricePane=new Z,this.indicatorPanes=[],this.crosshair=!1,this.volumeInPricePane=!1,this.menuVisible=!0,this.downloadSvgVisible=!0}};var et=class{constructor(){this.top=0,this.height=0}};var it=class{constructor(){this.height=0,this.pricePane={top:0,height:0},this.indicatorPanes=[],this.timeAxis={top:0,height:0},this.navigationPane={top:0,height:0}}};var at=class{};var D=class{};var nt=class{};var G=class{};var U=class{};var Y=class{};var rt=class{constructor(){this.indicatorBands=[],this.indicatorLineAreas=[],this.indicatorHorizontals=[],this.indicatorLines=[]}draw(A,e){let a=e.groupPrice.datum(),r=a.length-1,l=A.timeScale.zoomable().domain(),s=Math.round(l[0]),w=Math.round(l[1]);s<0&&(s=0),w>r&&(w=r),a[s]!==void 0&&(s=+a[s].time),a[w]!==void 0&&(w=+a[w].time);let c=Number.MAX_VALUE,n=Number.MIN_VALUE,f=Number.MAX_VALUE,h=Number.MIN_VALUE;if(this.indicatorHeatmap){let i=this.indicatorHeatmap.data;if(i.length>0){let t=i[0].parameterFirst,m=i[0].parameterLast;c=Math.min(t,m),n=Math.max(t,m);for(let p of i){let x=+p.time;s<=x&&x<=w&&p.values.length>0&&(f>p.valueMin&&(f=p.valueMin),h<p.valueMax&&(h=p.valueMax))}(h===Number.MIN_VALUE||f===Number.MAX_VALUE)&&(f=0,h=0)}}for(let i of this.indicatorBands){let t=i.data;for(let m of t){let p=+m.time;s<=p&&p<=w&&(c>m.lower&&(c=m.lower),n<m.upper&&(n=m.upper))}}for(let i of this.indicatorLineAreas){let t=i.data,m=i.value;for(let p of t){let x=+p.time;s<=x&&x<=w&&(c>p.value&&(c=p.value),n<p.value&&(n=p.value),c>m&&(c=m),n<m&&(n=m))}}for(let i of this.indicatorHorizontals){let t=i.value;c>t&&(c=t),n<t&&(n=t)}for(let i of this.indicatorLines){let t=i.data;for(let m of t){let p=+m.time;if(s<=p&&p<=w){let x=m.value;c>x&&(c=x),n<x&&(n=x)}}}if(this.indicatorHeatmap?this.yValue.domain([c,n]).nice():(c*=this.yMarginFactorBottom,n*=this.yMarginFactorTop,this.yValue.domain([c,n]).nice()),this.indicatorHeatmap){this.indicatorHeatmap.path.selectAll("image").remove();let i=this.indicatorHeatmap.data;if(i.length>0){let t=1+(i.length>1?A.timeScale(i[1].time)-A.timeScale(i[0].time):e.priceShape.width()(A.timeScale)),m=this.indicatorHeatmap.height,p=this.indicatorHeatmap.gradient,x=this.indicatorHeatmap.invertGradient,y=i[0].parameterFirst,o=i[0].parameterLast,d=i[0].parameterResolution,g=y>o,v=Math.min(y,o);for(let P of i){let V=+P.time;if(s<=V&&V<=w&&P.values.length>0){let Ee=A.timeScale(V)-t/2,We=this.heatColumn(P,v,d,g,P.valueMin,P.valueMax,p,x,t,m);this.indicatorHeatmap.path.append("image").attr("x",Ee).attr("width",t).attr("y",0).attr("height",m).attr("preserveAspectRatio","none").attr("xlink:href",We.toDataURL())}}}}this.indicatorBands.forEach(i=>i.path.attr("d",i.area)),this.indicatorLineAreas.forEach(i=>i.path.attr("d",i.area)),this.indicatorHorizontals.forEach(i=>i.path.attr("d",i.line)),this.indicatorLines.forEach(i=>i.path.attr("d",i.line)),this.yAxisLeft&&this.groupAxisLeft.call(this.yAxisLeft),this.yAxisRight&&this.groupAxisRight.call(this.yAxisRight)}setIndicatorDatum(){for(let A of this.indicatorBands)A.path.datum(A.data);for(let A of this.indicatorLineAreas)A.path.datum(A.data);for(let A of this.indicatorHorizontals)A.path.datum(A.data);for(let A of this.indicatorLines)A.path.datum(A.data)}heatColumn(A,e,a,r,l,s,w,c,n,f){let h=document.createElement("canvas");h.width=n,h.height=f,h.style.width=n+"px",h.style.height=f+"px",h.style.imageRendering="pixelated";let i=h.getContext("2d"),t=this.yValue,m=A.values;if(l!==0&&s!==1){let p=s-l;for(let x=0;x<f;++x){let y=Math.round((t.invert(x)-e)*a),o=(m[y]-l)/p;i.fillStyle=w(c?1-o:o),i.fillRect(0,r?f-x:x,n,1)}}else for(let p=0;p<f;++p){let x=Math.round((t.invert(p)-e)*a),y=m[x];i.fillStyle=w(c?1-y:y),i.fillRect(0,r?f-p:p,n,1)}return h}};var ot=class{};var st=class{constructor(){this.indicatorBands=[],this.indicatorLineAreas=[],this.indicatorHorizontals=[],this.indicatorLines=[],this.indicatorArrows=[]}draw(A){let e=this.groupPrice.datum(),a=e.length-1,r=A.timeScale.zoomable().domain(),l=Math.round(r[0]),s=Math.round(r[1]);l<0&&(l=0),s>a&&(s=a);let w=b.scale.plot.ohlc(e.slice.apply(e,[l,s]),this.priceAccessor).domain();e[l]!==void 0&&(l=+e[l].time),e[s]!==void 0&&(s=+e[s].time);let c=w[0],n=w[1];for(let i of this.indicatorBands){let t=i.data;for(let m of t){let p=+m.time;l<=p&&p<=s&&(c>m.lower&&(c=m.lower),n<m.upper&&(n=m.upper))}}for(let i of this.indicatorLineAreas){let t=i.data,m=i.value;for(let p of t){let x=+p.time;l<=x&&x<=s&&(c>p.value&&(c=p.value),n<p.value&&(n=p.value),c>m&&(c=m),n<m&&(n=m))}}for(let i of this.indicatorHorizontals){let t=i.value;c>t&&(c=t),n<t&&(n=t)}for(let i of this.indicatorLines){let t=i.data;for(let m of t){let p=+m.time;if(l<=p&&p<=s){let x=m.value;c>x&&(c=x),n<x&&(n=x)}}}let f,h;if(this.indicatorArrows.length>0){let i=this.priceShape.width()(A.timeScale);f=i<3?3:i,h=f*1.25;let t=h+3,m=this.yPrice.range()[0];if(t<m){let p=m-t;for(let x of this.indicatorArrows){let y=x.price,o=y*m;if(n<y&&(n=y),c>y&&(c=y),x.isDown){let d=(o-c*t)/p;n<d&&(n=d)}else{let d=(o-n*t)/p;c>d&&(c=d),c<0&&(c=0)}}}}c*=this.yMarginFactorBottom,n*=this.yMarginFactorTop,this.yPrice.domain([c,n]).nice(),this.indicatorBands.forEach(i=>i.path.attr("d",i.area)),this.indicatorLineAreas.forEach(i=>i.path.attr("d",i.area)),this.groupPrice.call(this.priceShape),this.volume&&this.groupVolume.call(this.volume),this.indicatorHorizontals.forEach(i=>i.path.attr("d",i.line)),this.indicatorLines.forEach(i=>i.path.attr("d",i.line));for(let i of this.indicatorArrows)i.arrow.width(f).height(h),i.path.attr("d",i.arrow);this.yAxisLeft&&this.groupAxisLeft.call(this.yAxisLeft),this.yAxisRight&&this.groupAxisRight.call(this.yAxisRight)}setIndicatorDatum(){this.indicatorBands.forEach(A=>A.path.datum(A.data)),this.indicatorLineAreas.forEach(A=>A.path.datum(A.data)),this.indicatorHorizontals.forEach(A=>A.path.datum(A.data)),this.indicatorLines.forEach(A=>A.path.datum(A.data))}};var lt=class{draw(){this.group.call(this.timeAxis)}};function Ye(u,A){if(u&1){let e=xt();M(0,"button",10),q("click",function(){N(e);let r=R(2);return C(r.downloadSvg())}),M(1,"mat-icon"),B(2,"download"),S()()}}function je(u,A){if(u&1){let e=xt();M(0,"mat-expansion-panel",2)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon"),B(4,"tune"),S(),B(5),S()(),M(6,"mat-button-toggle-group",4,0),q("change",function(){N(e);let r=zt(7),l=R();return C(l.ohlcvViewType=r.value)}),M(8,"mat-button-toggle",5),H(9,"mat-icon",6),S(),M(10,"mat-button-toggle",5),H(11,"mat-icon",7),S()(),M(12,"mat-slide-toggle",8),At("ngModelChange",function(r){N(e);let l=R();return yt(l.viewVolume,r)||(l.viewVolume=r),C(r)}),M(13,"mat-icon"),B(14,"leaderboard"),S()(),M(15,"mat-slide-toggle",8),At("ngModelChange",function(r){N(e);let l=R();return yt(l.viewCrosshair,r)||(l.viewCrosshair=r),C(r)}),M(16,"mat-icon"),B(17,"add"),S()(),ft(18,Ye,3,0,"button",9),S()}if(u&2){let e=R();L(5),Nt("\xA0",e.chartTitle,""),L(),j("value",e.ohlcvViewType),L(2),j("value",e.ohlcvViewCandlesticks),L(2),j("value",e.ohlcvViewBars),L(2),vt("ngModel",e.viewVolume),L(3),vt("ngModel",e.viewCrosshair),L(3),gt(e.viewDownloadSvg?18:-1)}}var dt=0,Lt=1,Fe=50,ze=10,ht=22,I=8,pt=5,St=50,ut=6,mt=20,F=6,Vt=20,qe=6,Ne=100,Oe=20,Ce=new Date(-864e13),He=new Date(864e13),Xe=`<html><meta charset="utf-8"><style>
  text { fill: black; font-family: Arial, Helvetica, sans-serif; }
  path.candle { stroke: black; }
  path.candle.up { fill: white; }
  path.candle.down { fill: black; }
  path.ohlc.up { fill: none; stroke: black; }
  path.ohlc.down { fill: none; stroke: black; }
  path.volume { fill: lightgrey; }
  path.area { fill: lightgrey; }
  path.line { stroke: black; }
  rect.selection { fill: darkgrey; }
</style><body>
`,Je=`
</body></html>
`,_e=!1,va=(()=>{class u{static valueToPixels(e,a){if(typeof e=="number")return+e;let r=+e.match(/\d+/);return e.endsWith("%")?r/100*a:r}static layoutHorizontal(e,a){let r=u.valueToPixels(e.width,a);e.widthMin&&e.widthMin>r&&(r=e.widthMin),e.widthMax&&e.widthMax<r&&(r=e.widthMax);let l=e.margin.left,s=r-l-e.margin.right,w=e.axisLeft?Fe:0,c=s-w-(e.axisRight?Fe:0);return{width:r,chart:{left:l,width:s},content:{left:w,width:c}}}static textBoundingClientRect(e,a=!1){let r=e.node(),l;return r&&r!=null?(l=r.getBoundingClientRect(),a&&e.remove()):l={width:100,height:12},l}static layoutVertical(e,a,r){let l=e.append("text").text("w"),s=u.textBoundingClientRect(l,!0).height,w=u.appendLegend(e,a.margin.top,s,r.content.left,r.content.width,a.pricePane,a.ohlcv.name),c=new it;c.pricePane.top=a.margin.top+w;let n=u.valueToPixels(a.pricePane.height,r.content.width);a.pricePane.heightMin&&a.pricePane.heightMin>n&&(n=a.pricePane.heightMin),a.pricePane.heightMax&&a.pricePane.heightMax<n&&(n=a.pricePane.heightMax),c.pricePane.height=n;let f=c.pricePane.top+c.pricePane.height;if(a.indicatorPanes&&a.indicatorPanes.length)for(let h of a.indicatorPanes){let i=new et,t=u.appendLegend(e,f,s,r.content.left,r.content.width,h,void 0);i.top=f+t,n=u.valueToPixels(h.height,r.content.width),h.heightMin&&h.heightMin>n&&(n=h.heightMin),h.heightMax&&h.heightMax<n&&(n=h.heightMax),i.height=n,c.indicatorPanes.push(i),f=i.top+i.height}if(c.timeAxis.top=f,c.timeAxis.height=ht,f+=c.timeAxis.height,c.navigationPane.top=f,a.navigationPane){let h=a.navigationPane;n=u.valueToPixels(h.height,r.content.width),h.heightMin&&h.heightMin>n&&(n=h.heightMin),h.heightMax&&h.heightMax<n&&(n=h.heightMax),h.hasTimeAxis&&(!h.timeTicks||h.timeTicks>0)&&(n+=ht),c.navigationPane.height=n,f+=n}return c.height=f+a.margin.bottom,c}static appendLegend(e,a,r,l,s,w,c=""){e=e.append("g").attr("class","legend"),a+=r/2,l+=I;let n=l,f=0;if(c&&c.length>0){let h=u.appendText(e,n,a,` ${c} `),i=u.textBoundingClientRect(h);n+=i.width+I,f=i.height}if(w.heatmap){let h=e.append("image").attr("x",n).attr("y",a-ut).attr("width",St).attr("height",ut).attr("preserveAspectRatio","none").attr("xlink:href",u.ramp(u.convertGradient(w.heatmap.gradient),w.heatmap.invertGradient,St,ut).toDataURL()),i=St+pt;n+=i;let t=u.appendText(e,n,a,w.heatmap.name),m=u.textBoundingClientRect(t);f===0&&(f=m.height);let p=m.width;n+p>s&&(a+=m.height,f+=m.height,h.attr("x",l).attr("y",a-ut),n=l+i,t.attr("x",n).attr("y",a)),n+=p+I}for(let h of w.bands){let i=e.append("rect").attr("x",n).attr("y",a-F).attr("width",mt).attr("height",F).attr("stroke-width",0).attr("fill",h.color),t=mt+pt;n+=t;let m=u.appendText(e,n,a,h.name),p=u.textBoundingClientRect(m);f===0&&(f=p.height);let x=p.width;n+x>s&&(a+=p.height,f+=p.height,i.attr("x",l).attr("y",a-F),n=l+t,m.attr("x",n).attr("y",a)),n+=x+I}for(let h of w.lineAreas){let i=e.append("rect").attr("x",n).attr("y",a-F).attr("width",mt).attr("height",F).attr("stroke-width",0).attr("fill",h.color),t=mt+pt;n+=t;let m=u.appendText(e,n,a,h.name),p=u.textBoundingClientRect(m);f===0&&(f=p.height);let x=p.width;n+x>s&&(a+=p.height,f+=p.height,i.attr("x",l).attr("y",a-F),n=l+t,m.attr("x",n).attr("y",a)),n+=x+I}for(let h of w.lines){let i=(qe-h.width)/2,t=e.append("line").attr("x1",n).attr("y1",a-i).attr("x2",n+Vt).attr("y2",a-i).attr("stroke-width",h.width).attr("stroke",h.color).attr("stroke-dasharray",h.dash).attr("fill","none"),m=Vt+pt;n+=m;let p=u.appendText(e,n,a,h.name),x=u.textBoundingClientRect(p);f===0&&(f=x.height);let y=x.width;n+y>s&&(a+=x.height,f+=x.height,t.attr("x1",l).attr("y1",a-i).attr("x2",l+Vt).attr("y2",a-i),n=l+m,p.attr("x",n).attr("y",a)),n+=y+I}return f}static firstTime(e){let a=e.ohlcv.data[0].time;for(let r of e.pricePane.bands){let s=r.data[0].time;a>s&&(a=s)}for(let r of e.pricePane.lines){let s=r.data[0].time;a>s&&(a=s)}for(let r of e.indicatorPanes){for(let l of r.bands){let w=l.data[0].time;a>w&&(a=w)}for(let l of r.lines){let w=l.data[0].time;a>w&&(a=w)}}return a}static lastTime(e){let a=e.ohlcv.data[e.ohlcv.data.length-1].time;for(let r of e.pricePane.bands){let l=r.data,s=l[l.length-1].time;a<s&&(a=s)}for(let r of e.pricePane.lines){let l=r.data,s=l[l.length-1].time;a<s&&(a=s)}for(let r of e.indicatorPanes){for(let l of r.bands){let s=l.data,w=s[s.length-1].time;a<w&&(a=w)}for(let l of r.lines){let s=l.data,w=s[s.length-1].time;a<w&&(a=w)}}return new Date(a.getFullYear(),a.getMonth(),a.getDay()+10)}static appendText(e,a,r,l){return e.append("text").attr("font-size","10px").attr("font-family","sans-serif").attr("x",a).attr("y",r).text(l)}static estimateNumberOfVerticalTicks(e){return e/Oe}static createPricePane(e,a,r,l,s,w,c,n,f,h){let i=e.pricePane,t=new st;t.yPrice=_().range([r.pricePane.height,0]);let m=i.valueMarginPercentageFactor;t.yMarginFactorTop=1+m,t.yMarginFactorBottom=1-m,t.priceShape=(c?b.plot.candlestick():b.plot.ohlc()).xScale(l).yScale(t.yPrice),t.priceAccessor=t.priceShape.accessor();let p="price-clip-"+h,x=`url(#${p})`;t.group=w.append("g").attr("class","price-pane").attr("transform",`translate(${a.content.left}, ${r.pricePane.top})`),t.group.append("clipPath").attr("id",p).append("rect").attr("x",0).attr("y",t.yPrice(1)).attr("width",a.content.width).attr("height",t.yPrice(0)-t.yPrice(1));for(let o=0;o<i.bands.length;++o){let d=i.bands[o],g=new D;g.path=t.group.append("g").attr("class",`band-${o}`).attr("clip-path",x).append("path").attr("fill",d.color),g.area=$().curve(u.convertInterpolation(d.interpolation)).defined(v=>{let P=v;return!isNaN(P.lower)&&!isNaN(P.upper)}).x(v=>l(v.time)).y0(v=>{let P=v;return t.yPrice(P.lower)}).y1(v=>{let P=v;return t.yPrice(P.upper)}),g.data=d.data,t.indicatorBands.push(g)}for(let o=0;o<i.lineAreas.length;++o){let d=i.lineAreas[o],g=d.value,v=new U;v.path=t.group.append("g").attr("class",`linearea-${o}`).attr("clip-path",x).append("path").attr("fill",d.color),v.area=$().curve(u.convertInterpolation(d.interpolation)).defined(P=>!isNaN(P.value)).x(P=>l(P.time)).y0(P=>{let V=P;return t.yPrice(V.value)}).y1(()=>t.yPrice(g)),v.data=d.data,v.value=d.value,t.indicatorLineAreas.push(v)}for(let o=0;o<i.horizontals.length;++o){let d=i.horizontals[o],g=new G;g.path=t.group.append("g").attr("class",`horizontal-${o}`).attr("clip-path",x).append("path").attr("stroke",d.color).attr("stroke-width",d.width).attr("stroke-dasharray",d.dash).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("fill","none");let v=d.value;g.value=v,g.data=[new T({time:Ce,value:v}),new T({time:He,value:v})],g.line=W().x(P=>l(P.time)).y(()=>t.yPrice(v)),t.indicatorHorizontals.push(g)}for(let o=0;o<i.lines.length;++o){let d=i.lines[o],g=new Y;g.path=t.group.append("g").attr("class",`line-${o}`).attr("clip-path",x).append("path").attr("stroke",d.color).attr("stroke-width",d.width).attr("stroke-dasharray",d.dash).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("fill","none"),g.line=W().curve(u.convertInterpolation(d.interpolation)).defined(v=>!isNaN(v.value)).x(v=>l(v.time)).y(v=>{let P=v;return t.yPrice(P.value)}),g.data=d.data,t.indicatorLines.push(g)}t.groupPrice=t.group.append("g").attr("class","price").attr("clip-path",x),n&&(t.yVolume=_().range([t.yPrice(0),t.yPrice(.3)]),t.volume=b.plot.volume().xScale(l).yScale(t.yVolume),t.groupVolume=t.group.append("g").attr("class","volume").attr("clip-path",x));let y;for(let o of i.arrows){y||(y=t.group.append("g").attr("class","arrows").attr("clip-path",x));let d=new at;d.isDown=o.down,d.path=y.append("path").attr("stroke-width",0).attr("fill",o.color);let g=u.getArrowPrice(e.ohlcv.data,o);d.price=g,d.arrow=b.shapes.arrow().orient(o.down?"down":"up").x(()=>l(o.time)).y(()=>{let v=t.yPrice(g);return o.down?v-3:v+3}),t.indicatorArrows.push(d)}if(e.axisLeft&&(t.yAxisLeft=kt(t.yPrice).tickSizeOuter(0).tickFormat(k(i.valueFormat)),i.valueTicks?t.yAxisLeft.ticks(i.valueTicks):t.yAxisLeft.ticks(u.estimateNumberOfVerticalTicks(r.pricePane.height)),t.groupAxisLeft=t.group.append("g").attr("class","y axis left")),e.axisRight&&(t.yAxisRight=Pt(t.yPrice).tickSizeOuter(0).tickFormat(k(i.valueFormat)),i.valueTicks?t.yAxisRight.ticks(i.valueTicks):t.yAxisRight.ticks(u.estimateNumberOfVerticalTicks(r.pricePane.height)),t.groupAxisRight=t.group.append("g").attr("class","y axis right").attr("transform",`translate(${a.content.width}, 0)`)),f){let o=b.plot.crosshair().xScale(l).yScale(t.yPrice).xAnnotation(s).verticalWireRange([0,r.timeAxis.top]);if(e.axisLeft&&e.axisRight){let d=b.plot.axisannotation().axis(t.yAxisLeft).orient("left").format(k(i.valueFormat)),g=b.plot.axisannotation().axis(t.yAxisRight).orient("right").format(k(i.valueFormat)).translate([l(1),0]);o=o.yAnnotation([d,g])}else if(e.axisLeft){let d=b.plot.axisannotation().axis(t.yAxisLeft).orient("left").format(k(i.valueFormat));o=o.yAnnotation(d)}else if(e.axisRight){let d=b.plot.axisannotation().axis(t.yAxisRight).orient("right").format(k(i.valueFormat)).translate([l(1),0]);o=o.yAnnotation(d)}t.group.append("g").attr("class","crosshair").call(o)}return t}static createIndicatorPane(e,a,r,l,s,w,c,n,f){let h=l.indicatorPanes[e],i=a.indicatorPanes[e],t=new rt;t.yValue=_().range([h.height,0]);let m=i.valueMarginPercentageFactor;t.yMarginFactorTop=1+m,t.yMarginFactorBottom=1-m;let p=`indicator-clip-${e}-${f}`,x=`url(#${p})`;if(t.group=c.append("g").attr("class","indicator-pane").attr("transform",`translate(${r.content.left}, ${h.top})`),t.group.append("clipPath").attr("id",p).append("rect").attr("x",0).attr("y",t.yValue(1)).attr("width",r.content.width).attr("height",t.yValue(0)-t.yValue(1)),i.heatmap){let y=i.heatmap,o=new nt;o.path=t.group.append("g").attr("class","heatmap").attr("clip-path",x),o.invertGradient=y.invertGradient,o.gradient=u.convertGradient(y.gradient),o.data=y.data,o.height=h.height,t.indicatorHeatmap=o}for(let y=0;y<i.bands.length;++y){let o=i.bands[y],d=new D;d.path=t.group.append("g").attr("class",`band-${y}`).attr("clip-path",x).append("path").attr("fill",o.color),d.area=$().curve(u.convertInterpolation(o.interpolation)).defined(g=>{let v=g;return!isNaN(v.lower)&&!isNaN(v.upper)}).x(g=>s(g.time)).y0(g=>{let v=g;return t.yValue(v.lower)}).y1(g=>{let v=g;return t.yValue(v.upper)}),d.data=o.data,t.indicatorBands.push(d)}for(let y=0;y<i.lineAreas.length;++y){let o=i.lineAreas[y],d=o.value,g=new U;g.path=t.group.append("g").attr("class",`linearea-${y}`).attr("clip-path",x).append("path").attr("fill",o.color),g.area=$().curve(u.convertInterpolation(o.interpolation)).defined(v=>!isNaN(v.value)).x(v=>s(v.time)).y0(v=>{let P=v;return t.yValue(P.value)}).y1(()=>t.yValue(d)),g.data=o.data,g.value=o.value,t.indicatorLineAreas.push(g)}for(let y=0;y<i.horizontals.length;++y){let o=i.horizontals[y],d=new G;d.path=t.group.append("g").attr("class",`horizontal-${y}`).attr("clip-path",x).append("path").attr("stroke",o.color).attr("stroke-width",o.width).attr("stroke-dasharray",o.dash).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("fill","none");let g=o.value;d.value=g,d.data=[new T({time:Ce,value:g}),new T({time:He,value:g})],d.line=W().x(v=>s(v.time)).y(()=>t.yValue(g)),t.indicatorHorizontals.push(d)}for(let y=0;y<i.lines.length;++y){let o=i.lines[y],d=new Y;d.path=t.group.append("g").attr("class",`line-${y}`).attr("clip-path",x).append("path").attr("stroke",o.color).attr("stroke-width",o.width).attr("stroke-dasharray",o.dash).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("fill","none"),d.line=W().curve(u.convertInterpolation(o.interpolation)).defined(g=>!isNaN(g.value)).x(g=>s(g.time)).y(g=>{let v=g;return t.yValue(v.value)}),d.data=o.data,t.indicatorLines.push(d)}if(a.axisLeft&&(t.yAxisLeft=kt(t.yValue).tickSizeOuter(0).tickFormat(k(i.valueFormat)),i.valueTicks?t.yAxisLeft.ticks(i.valueTicks):t.yAxisLeft.ticks(u.estimateNumberOfVerticalTicks(h.height)),t.groupAxisLeft=t.group.append("g").attr("class","y axis left")),a.axisRight&&(t.yAxisRight=Pt(t.yValue).tickSizeOuter(0).tickFormat(k(i.valueFormat)),i.valueTicks?t.yAxisRight.ticks(i.valueTicks):t.yAxisRight.ticks(u.estimateNumberOfVerticalTicks(h.height)),t.groupAxisRight=t.group.append("g").attr("class","y axis right").attr("transform",`translate(${r.content.width}, 0)`)),n){let y=l.timeAxis.top-h.top,o=b.plot.axisannotation().axis(w).orient("bottom").width(65).translate([0,y]);a.timeAnnotationFormat&&o.format(E(a.timeAnnotationFormat));let d=b.plot.crosshair().xScale(s).yScale(t.yValue).xAnnotation(o).verticalWireRange([l.pricePane.top-h.top,y]);if(a.axisLeft&&a.axisRight){let g=b.plot.axisannotation().axis(t.yAxisLeft).orient("left").format(k(i.valueFormat)),v=b.plot.axisannotation().axis(t.yAxisRight).orient("right").format(k(i.valueFormat)).translate([s(1),0]);d=d.yAnnotation([g,v])}else if(a.axisLeft){let g=b.plot.axisannotation().axis(t.yAxisLeft).orient("left").format(k(i.valueFormat));d=d.yAnnotation(g)}else if(a.axisRight){let g=b.plot.axisannotation().axis(t.yAxisRight).orient("right").format(k(i.valueFormat)).translate([s(1),0]);d=d.yAnnotation(g)}t.group.append("g").attr("class","crosshair").call(d)}return t}static createNavPane(e,a,r,l){let s=a.content.width,w=r.navigationPane.height,c=new ot;if(e.navigationPane!==void 0){let n=e.navigationPane,f=n.hasTimeAxis?w-ht:w;c.timeScale=b.scale.financetime().range([0,s]),c.priceScale=_().range([f,0]),c.brush=qt().extent([[0,0],[s,f]]),n.hasArea&&(c.area=b.plot.ohlcarea().xScale(c.timeScale).yScale(c.priceScale)),n.hasLine&&(c.line=b.plot.closeline().xScale(c.timeScale).yScale(c.priceScale)),n.hasTimeAxis&&(c.timeAxis=bt(c.timeScale).tickSizeOuter(0),n.timeTicksFormat!==void 0&&c.timeAxis.tickFormat(E(n.timeTicksFormat)),n.timeTicks!==void 0?c.timeAxis.ticks(n.timeTicks):c.timeAxis.ticks(a.content.width/Ne)),c.group=l.append("g").attr("class","nav").attr("transform",`translate(${a.content.left}, ${r.navigationPane.top})`).attr("height",w),n.hasArea&&(c.areaSelection=c.group.append("g").attr("class","area").attr("height",f)),n.hasLine&&(c.lineSelection=c.group.append("g").attr("class","line").attr("fill","none").attr("stroke-width",.5).attr("height",f)),c.paneSelection=c.group.append("g").attr("class","pane").attr("height",f),n.hasTimeAxis&&(c.timeAxisSelection=c.group.append("g").attr("class","x axis").attr("height",ht).attr("transform",`translate(0, ${f})`))}return c}static createTimePane(e,a,r,l){let s=new lt;return s.timeScale=b.scale.financetime().range([0,a.content.width]),s.timeAxis=bt(s.timeScale).tickSizeOuter(0),e.timeTicksFormat!==void 0&&s.timeAxis.tickFormat(E(e.timeTicksFormat)),e.timeTicks!==void 0?s.timeAxis.ticks(e.timeTicks):s.timeAxis.ticks(a.content.width/Ne),s.timeAnnotation=b.plot.axisannotation().axis(s.timeAxis).orient("bottom").width(65).translate([0,r.timeAxis.top-r.pricePane.top]),e.timeAnnotationFormat!==void 0&&s.timeAnnotation.format(E(e.timeAnnotationFormat)),s.group=l.append("g").attr("class","x axis").attr("height",r.timeAxis.height).attr("transform",`translate(${a.content.left}, ${r.timeAxis.top})`),s}static convertInterpolation(e){switch(e.toLowerCase()){case"step":return ke;case"stepbefore":return Me;case"stepafter":return Le;case"natural":return be;case"basis":return ye;case"catmullrom":return Pe;case"cardinal":return Ae;default:return ve}}static findOhlcv(e,a){for(let r of e)if(+r.time>=+a)return r;return null}static getArrowPrice(e,a){if(a.value)return+a.value;let r=u.findOhlcv(e,a.time);return r!=null?a.down?r.high:r.low:0}static ramp(e,a,r,l){let s=document.createElement("canvas");s.width=r,s.height=l,s.style.width=r+"px",s.style.height=l+"px",s.style.imageRendering="pixelated";let w=s.getContext("2d"),c=1/(r-1);for(let n=0;n<r;++n)w.fillStyle=e(a?1-n*c:n*c),w.fillRect(n,0,1,l);return s}static convertGradient(e){switch(e.toLowerCase()){case"viridis":return fe;case"inferno":return xe;case"magma":return ge;case"plasma":return we;case"warm":return pe;case"cool":return ue;case"rainbow":return me;case"cubehelixdefault":return he;case"bugn":return Ot;case"bupu":return Xt;case"gnbu":return Jt;case"orrd":return Kt;case"pubugn":return Qt;case"pubu":return Zt;case"purd":return te;case"rdpu":return ee;case"ylgnbu":return ie;case"ylgn":return ae;case"ylorbr":return ne;case"ylorrd":return re;case"blues":return oe;case"greens":return se;case"greys":return Mt;case"oranges":return de;case"purples":return ce;case"reds":return le;default:return Mt}}get viewMenu(){return this.config?this.config.menuVisible:!1}get viewDownloadSvg(){return this.config?this.config.downloadSvgVisible:!1}get ohlcvViewType(){return this.ohlcvView}set ohlcvViewType(e){this.ohlcvView=e,this.render()}get viewCrosshair(){return this.renderCrosshair}set viewCrosshair(e){this.renderCrosshair=e,this.render()}get viewVolume(){return this.renderVolume}set viewVolume(e){this.renderVolume=e,this.render()}get chartTitle(){return this.config?this.config.ohlcv.name:"---"}constructor(){this.document=z(Ht),this.platformId=z(Rt),this.random=Math.random().toString(36).substring(2),this.svgContainerId="ohlcv-chart-svg-"+this.random,this.widthContainerId="ohlcv-chart-width-"+this.random,this.currentSelection=null,this.ohlcvViewCandlesticks=dt,this.ohlcvViewBars=Lt,this.configuration=Tt.required(),Ct(()=>{let r=this.configuration();r&&r!=null?(this.config=r,this.ohlcvView=r.ohlcv.candlesticks?dt:Lt,this.renderCrosshair=r.crosshair,this.renderVolume=r.volumeInPricePane,this.currentSelection=null):this.config=new tt,this.render()});let e=z(Ut),a=z(Et);e.addSvgIcon("mb-candlesticks",a.bypassSecurityTrustResourceUrl("assets/mb/mb-candlesticks.svg")),e.addSvgIcon("mb-bars",a.bypassSecurityTrustResourceUrl("assets/mb/mb-bars.svg")),this.renderVolume=this.config?this.config.volumeInPricePane:!0,this.renderCrosshair=this.config?this.config.crosshair:!0,this.ohlcvView=this.config&&!this.config.ohlcv.candlesticks?Lt:dt,Bt({write:()=>{this.render()}})}downloadSvg(){let e=new Date,a=`olcv-chart_${e.getFullYear()}-${e.getMonth()}-${e.getDay()}_${e.getHours()}-${e.getMinutes()}-${e.getSeconds()}.html`,r=O("#"+this.widthContainerId).node();X.download(X.serializeToSvg(X.getChildElementById(r.parentNode,this.svgContainerId),Xe,Je),a)}render(){if(!_t(this.platformId)||!this.document||this.document===null)return;let e=this.config;if(!e||!e.width)return;let a=this.random,r=O("#"+this.widthContainerId).node();if(!r||r===null)return;let l=r.offsetWidth,s=u.layoutHorizontal(e,l),w=O("#"+this.svgContainerId);w.select("svg").remove();let c=w.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",s.width),n=u.layoutVertical(c,e,s);c.attr("height",n.height).attr("viewBox",`0 0 ${s.width} ${n.height}`);let f=u.createTimePane(e,s,n,c),h=u.createPricePane(e,s,n,f.timeScale,f.timeAnnotation,c,this.ohlcvView===dt,this.renderVolume,this.renderCrosshair,a),i=[];for(let o=0;o<e.indicatorPanes.length;++o){let d=u.createIndicatorPane(o,e,s,n,f.timeScale,f.timeAxis,c,this.renderCrosshair,a);i.push(d)}let t=u.createNavPane(e,s,n,c);function m(){f.draw(),h.draw(f),i.forEach(o=>o.draw(f,h))}let p=o=>{this.currentSelection=o};function x(o){let d=f.timeScale.zoomable(),g=t.timeScale.zoomable();d.domain(g.domain()),o.selection?(p(o.selection),d.domain(o.selection.map(d.invert)),_e||m()):(p(null),m())}function y(o){if(o.selection){let d=o.selection;if(d[1]-d[0]>ze){let g=f.timeScale.zoomable(),v=t.timeScale.zoomable();g.domain(v.domain()),g.domain(o.selection.map(g.invert)),m()}}}if(_e&&t.brush.on("brush",y),t.brush.on("end",x),f.timeScale.domain(e.ohlcv.data.map(h.priceAccessor.time)),t.timeScale.domain(f.timeScale.domain()),h.yPrice.domain(b.scale.plot.ohlc(e.ohlcv.data,h.priceAccessor).domain()),t.priceScale.domain(h.yPrice.domain()),h.yVolume&&h.yVolume.domain(b.scale.plot.volume(e.ohlcv.data).domain()),h.groupPrice.datum(e.ohlcv.data),this.renderVolume&&h.groupVolume.datum(e.ohlcv.data),h.setIndicatorDatum(),i.forEach(o=>o.setIndicatorDatum()),t.area&&t.areaSelection.datum(e.ohlcv.data).call(t.area),t.line&&t.lineSelection.datum(e.ohlcv.data).call(t.line),t.timeAxis&&t.timeAxisSelection.call(t.timeAxis),t.paneSelection.call(t.brush).selectAll("rect").attr("height",n.navigationPane.height),this.currentSelection!=null&&this.currentSelection[1]-this.currentSelection[0]>ze){t.brush.move(t.paneSelection,this.currentSelection);let o=f.timeScale.zoomable(),d=t.timeScale.zoomable();o.domain(d.domain()),o.domain(this.currentSelection.map(o.invert))}m()}static{this.\u0275fac=function(a){return new(a||u)}}static{this.\u0275cmp=Ft({type:u,selectors:[["mb-ohlcv-chart"]],hostBindings:function(a,r){a&1&&q("resize",function(){return r.render()},!1,It)},inputs:{configuration:[1,"configuration"]},decls:3,vars:3,consts:[["group1","matButtonToggleGroup"],[1,"container",3,"id"],["expanded","false"],[3,"id"],[1,"button-toggle-group",3,"change","value"],[3,"value"],["svgIcon","mb-candlesticks",1,"svg-icon"],["svgIcon","mb-bars",1,"svg-icon"],[1,"slide-toggle",3,"ngModelChange","ngModel"],["mat-mini-fab","","color","accent",1,"download"],["mat-mini-fab","","color","accent",1,"download",3,"click"]],template:function(a,r){a&1&&(H(0,"div",1),ft(1,je,19,7,"mat-expansion-panel",2),H(2,"div",3)),a&2&&(wt("id",r.widthContainerId),L(),gt(r.viewMenu?1:-1),L(),wt("id",r.svgContainerId))},dependencies:[Dt,Wt,$t,Yt,Gt,Ve,Se,jt,Te,Re,Be],styles:[".container[_ngcontent-%COMP%]{margin:0;padding:0 8px;height:1px}.button-toggle-group[_ngcontent-%COMP%]{margin:0 16px 0 0}.slide-toggle[_ngcontent-%COMP%]{margin:0 16px 0 0;vertical-align:middle}.download[_ngcontent-%COMP%]{vertical-align:middle}mat-slide-toggle[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{vertical-align:bottom}[_nghost-%COMP%]     path.candle.body{stroke-width:1px}[_nghost-%COMP%]     path.ohlc{stroke-width:1px}[_nghost-%COMP%]     .extent{fill-opacity:.125;shape-rendering:crispEdges}[_nghost-%COMP%]     .coords{font:10px sans-serif}[_nghost-%COMP%]     .crosshair{cursor:crosshair;font:10px sans-serif}[_nghost-%COMP%]     .crosshair path.wire{stroke-dasharray:1,1}"],changeDetection:0})}}return u})();export{T as a,va as b};
