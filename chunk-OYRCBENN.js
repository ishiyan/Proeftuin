import{$ as G,C as Z,a as V,d as F,e as q,f as I,ha as J,i as _,k as W,l as Y}from"./chunk-FQYT43UK.js";import{a as E}from"./chunk-IEKDCRBV.js";import{Aa as k,Qa as et,k as L,q as B,x as H,z as P}from"./chunk-GXN2U6XA.js";import{Aa as R,Lc as i,Ub as T,Va as C,Xb as $,Yb as j,ca as O,ib as A,xa as S}from"./chunk-VOP6QBU4.js";et();var nt=["*"],b=2*Math.PI,it=180/Math.PI,v=300,at=0,ot=750,K="asc",st="desc",rt=!1,lt="white",Ot=(()=>{let r=class r{constructor(){this.elementRef=O(R),this.sumFunc=i(V),this.sort=i(K),this.zoom=i(rt),this.transitionMsec=i(ot),this.levels=i(at),this.labelFunc=i(_),this.labelFill=i(lt),this.labelFontSizeFunc=i(J),this.tooltipFunc=i(W),this.tapFunc=i(Y),this.fillFunc=i(Z),this.fillOpacityFunc=i(G),this.diameter=i(v),this.data=i.required()}ngOnChanges(l){this.render()}render(){let l=L(this.elementRef.nativeElement);l.select("svg").remove();let a=this.data();if(!a||!a.children||a.children.length<1)return;let m=E(this.elementRef,this.diameter(),this.diameter(),v,v),s=Math.max(m[0],m[1]),x=s/2,h=l.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",s).attr("height",s).attr("viewBox",`0 0 ${s} ${s}`).append("g").attr("transform",`translate(${x},${x})`),y=this.sort(),M=y===K?q:y===st?I:F,o=(t=>{let n=H(t).sum(this.sumFunc());return M!==F&&(n=n.sort((u,e)=>M(u,e))),P().size([b,n.height+1])(n)})(a);o.each(t=>t.current=t);let g=(this.levels()<1?o.height:this.levels())+1,c=s/(2*g),D=k().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(c*1.5).innerRadius(t=>t.y0*c).outerRadius(t=>Math.max(t.y0*c,t.y1*c-1)),d=t=>t.y1<=g&&t.y0>=1&&t.x1>t.x0,f=t=>t.y1<=g&&t.y0>=1&&(t.y1-t.y0)*(t.x1-t.x0)>.05,N=t=>{let n=(t.x0+t.x1)/2*it,u=(t.y0+t.y1)/2*c;return`rotate(${n-90}) translate(${u},0) rotate(${n<180?0:180})`},z=(t,n)=>{if(this.tapFunc()(n),this.zoom()&&n.children){U.datum(n.parent||o),o.each(e=>e.target={x0:Math.max(0,Math.min(1,(e.x0-n.x0)/(n.x1-n.x0)))*b,x1:Math.max(0,Math.min(1,(e.x1-n.x0)/(n.x1-n.x0)))*b,y0:Math.max(0,e.y0-n.depth),y1:Math.max(0,e.y1-n.depth)});let u=h.transition().duration(this.transitionMsec());w.transition(u).tween("data",e=>{let X=B(e.current,e.target);return tt=>e.current=X(tt)}).filter(e=>d(e.current)||d(e.target)).attr("fill-opacity",e=>d(e.target)?this.fillOpacityFunc()(e,o.height):0).attrTween("d",e=>()=>D(e.current)),Q.filter(e=>d(e.current)||f(e.target)).transition(u).attr("fill-opacity",e=>+f(e.target)).attrTween("transform",e=>()=>N(e.current))}},w=h.append("g").selectAll("path").data(o.descendants().slice(1)).join("path").attr("fill",this.fillFunc()).attr("fill-opacity",t=>d(t.current)?this.fillOpacityFunc()(t,o.height):0).attr("d",t=>D(t.current)).on("click",z);w.append("title").text(t=>this.tooltipFunc()(t));let Q=h.append("g").attr("pointer-events","none").attr("text-anchor","middle").style("user-select","none").style("fill",this.labelFill()).selectAll("text").data(o.descendants().slice(1)).join("text").attr("font-size",t=>this.labelFontSizeFunc()(t)).attr("dy","0.35em").attr("fill-opacity",t=>+f(t.current)).attr("transform",t=>N(t.current)).text(t=>this.labelFunc()(t)),U=h.append("circle").datum(o).attr("r",c).attr("fill","none").attr("pointer-events","all").on("click",z)}};r.\u0275fac=function(a){return new(a||r)},r.\u0275cmp=A({type:r,selectors:[["mb-sunburst"]],hostBindings:function(a,m){a&1&&T("resize",function(){return m.render()},C)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],zoom:[1,"zoom"],transitionMsec:[1,"transitionMsec"],levels:[1,"levels"],labelFunc:[1,"labelFunc"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],diameter:[1,"diameter"],data:[1,"data"]},features:[S],ngContentSelectors:nt,decls:1,vars:0,template:function(a,m){a&1&&($(),j(0))},encapsulation:2,changeDetection:0});let p=r;return p})();export{Ot as a};
