import{a as Z}from"./chunk-S53QGRZ7.js";import{a as b}from"./chunk-3H6C7N3C.js";import{a as Q}from"./chunk-IEKDCRBV.js";import{Ca as Y,Da as J,G as q,Qa as ot,Y as K,f as $,g as X,h as j,i as S,k as G}from"./chunk-GXN2U6XA.js";import{Ca as H,Jc as A,Mc as m,Wa as B,Wb as W,Zb as U,_b as F,ca as z,ib as P,za as R}from"./chunk-54YCK6MI.js";import{a as D}from"./chunk-VOSPIT4N.js";ot();var rt=["*"],lt={fillColor:void 0,strokeColor:"steelblue",strokeWidth:1,interpolation:"natural"},ct="natural",ft=new Date(-864e13),dt=new Date(864e13),tt=300,et=100,it=60,O=30,E=50,_=18,Mt=(()=>{let T=class T{constructor(){this.elementRef=z(H),this.width=m(tt),this.height=m(et),this.timeAxis=m([]),this.valueAxis=m([]),this.currentConfiguration=[],this.currentDataStacked=[],this.currentDataEmpty=!0,this.configuration=m.required(),this.min=m(),this.max=m(),this.from=m(),this.till=m(),this.data=m.required(),A(()=>{this.forcedValueMin=this.min()}),A(()=>{this.forcedValueMax=this.max()}),A(()=>{this.forcedTimeMin=this.from()}),A(()=>{this.forcedTimeMax=this.till()}),A(()=>{let e=this.data(),i=dt,f=ft,l=-1/0,t=!0,h=[],g=0;for(let n of e){h.push([]);let c=n.length;c<1||(t=!1,g<c&&(g=c),i>n[0].time&&(i=n[0].time),f<n[c-1].time&&(f=n[c-1].time))}let x=e.length;for(let n=0;n<g;++n){let c=0;for(let p=0;p<x;++p){let C=h[p],k=e[p];if(k.length>n){let r=Z(k)(k[n]);isNaN(r)||(r+=c,C.push({time:k[n].time,lower:c,upper:r}),c=r,l<r&&(l=r))}}}this.currentDataEmpty=t,this.dataTimeMin=i,this.dataTimeMax=f,this.dataValueMax=l,this.currentDataStacked=h,this.render()}),A(()=>{let e=this.configuration();if(e&&e!=null&&e.length>0){let i=e.length,f=this.currentConfiguration.length;if(f>0){let l=Math.min(i,f);for(let t=0;t<l;++t)this.currentConfiguration[t]=D(D({},this.currentConfiguration[t]),e[t]);if(i>l)for(let t=l;t<i;++t)this.currentConfiguration[t]=D({},e[t])}else this.currentConfiguration=[...e]}this.render()})}ngAfterViewInit(){setTimeout(()=>this.render(),0)}ngOnChanges(e){this.render()}render(){let e=G(this.elementRef.nativeElement);e.select("svg").remove();let i=this.currentDataStacked;if(this.currentDataEmpty||!i||i.length<1)return;let f=this.currentConfiguration,l=this.timeAxis().includes("top"),t=this.timeAxis().includes("bottom"),h=this.valueAxis().includes("left"),g=this.valueAxis().includes("right"),x=this.valueAxis().includes("grid"),n=h||x?E:l||t?E/3:0,c=g?E:l||t?E/3:0,p=l?_:h||g||x?_/3:0,C=t?_:h||g||x?_/3:0,k=Q(this.elementRef,this.width(),this.height(),tt,et),r=k[0],v=k[1],M=e.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",r).attr("height",v).attr("viewBox",`0 0 ${r} ${v}`),I=this.forcedTimeMin===void 0?this.dataTimeMin:this.forcedTimeMin,N=this.forcedTimeMax===void 0?this.dataTimeMax:this.forcedTimeMax,y=K().range([n,r-c]).domain([I,N]);if(l){y.nice();let a=d=>d.attr("font-family","sans-serif").attr("font-size",10).attr("fill","none").attr("transform",`translate(0,${p})`).call($(y).ticks(r/it).tickSizeOuter(0));M.append("g").call(a)}if(t){y.nice();let a=d=>d.attr("font-family","sans-serif").attr("font-size",10).attr("fill","none").attr("transform",`translate(0,${v-C})`).call(j(y).ticks(r/it).tickSizeOuter(0));M.append("g").call(a)}let nt=this.forcedValueMin===void 0?0:this.forcedValueMin,at=this.forcedValueMax===void 0?this.dataValueMax:this.forcedValueMax,u=q().domain([nt,at]).range([v-C,p]);if(h&&!x){u.nice();let a=d=>d.attr("transform",`translate(${n},0)`).call(S(u).ticks(v/O).tickSizeOuter(0));M.append("g").call(a)}if(g){u.nice();let a=d=>d.attr("transform",`translate(${r-c},0)`).call(X(u).ticks(v/O).tickSizeOuter(0));M.append("g").call(a)}if(x){u.nice();let a=d=>d.attr("transform",`translate(${n},0)`).call(S(u).ticks(v/O).tickSizeOuter(0)).call(s=>{h||s.select(".domain").remove()}).call(s=>s.selectAll(t?".tick:not(:first-of-type) line":".tick line").clone().attr("x2",r-n-c).attr("stroke","currentColor").attr("stroke-width",.3));M.append("g").call(a)}let st=f.length;for(let a=0;a<i.length;++a){let d=i[a],s=a<st?f[a]:lt,V=s.interpolation?s.interpolation:ct;if(s.fillColor&&s.fillColor!=="none"){let L=J().curve(b(V)).defined(o=>o.time>=I&&o.time<=N).x(o=>y(o.time)).y0(o=>u(o.lower)).y1(o=>u(o.upper));M.append("path").datum(d).attr("fill",s.fillColor).attr("d",L)}if(s.strokeColor&&s.strokeWidth&&s.strokeWidth>0&&s.strokeColor!=="none"){let L=Y().curve(b(V)).defined(o=>o.time>=I&&o.time<=N).x(o=>y(o.time)).y(o=>u(o.upper));M.append("path").datum(d).attr("stroke-width",s.strokeWidth).attr("stroke",s.strokeColor).attr("stroke-linejoin","round").attr("stroke-linecap","round").style("fill","none").attr("d",L)}}}};T.\u0275fac=function(i){return new(i||T)},T.\u0275cmp=P({type:T,selectors:[["mb-stackiline"]],hostBindings:function(i,f){i&1&&W("resize",function(){return f.render()},B)},inputs:{width:[1,"width"],height:[1,"height"],timeAxis:[1,"timeAxis"],valueAxis:[1,"valueAxis"],configuration:[1,"configuration"],min:[1,"min"],max:[1,"max"],from:[1,"from"],till:[1,"till"],data:[1,"data"]},features:[R],ngContentSelectors:rt,decls:1,vars:0,template:function(i,f){i&1&&(U(),F(0))},styles:["[_nghost-%COMP%]{---stackline-grid-color: var(--stackline-grid-color, var(--mat-stackline-grid-color, var(--mat-sys-on-surface-variant)));---stackline-grid-opacity: var(--stackline-grid-opacity, var(--mat-stackline-grid-opacity, .5));---stackline-axis-color: var(--stackline-axis-color, var(--mat-stackline-axis-color, var(--mat-sys-on-surface-variant)));---stackline-axis-font-family: var(--stackline-axis-font-family, var(--mat-stackline-axis-font-family, Roboto, sans-serif));---stackline-axis-font-size: var(--stackline-axis-font-size, var(--mat-stackline-axis-font-size, 12px));---stackline-axis-font-weight: var(--stackline-axis-font-weight, var(--mat-stackline-axis-font-weight, 400))}[_nghost-%COMP%]     g.axis path{fill:none;stroke:var(---stackline-axis-color)}[_nghost-%COMP%]     g.axis line{fill:none;stroke:var(---stackline-axis-color)}[_nghost-%COMP%]     g.axis text{fill:var(---stackline-axis-color);font-family:var(---stackline-axis-font-family);font-size:var(---stackline-axis-font-size);font-weight:var(---stackline-axis-font-weight);cursor:default}[_nghost-%COMP%]     g.axis .tick:not(:first-child) line{fill:none;stroke:var(---stackline-grid-color);stroke-opacity:var(---stackline-grid-opacity)}"],changeDetection:0});let w=T;return w})();export{Mt as a};
