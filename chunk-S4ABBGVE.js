import{b as q,g as B}from"./chunk-CGVYBZUD.js";import{$ as I,C as V,a as W,d as F,e as L,f as _,ha as G,i as j,k as H,l as $}from"./chunk-JEPWSQCW.js";import{a as D}from"./chunk-IEKDCRBV.js";import{A as O,B as T,Qa as U,k as A,x as C}from"./chunk-GDNQNY7K.js";import{Aa as w,Cc as e,Nb as M,Pb as N,Qb as E,Ua as S,ba as x,gb as z,xa as k}from"./chunk-OH5MFEO2.js";U();var Z=["*"],X=300,Y=300,tt=1,et=1.618,P="asc",it="desc",nt=!1,ot="white",st=.1,at=4,J=16,zt=(()=>{let o=class o{constructor(){this.elementRef=x(w),this.sumFunc=e(W),this.sort=e(P),this.labelFunc=e(j),this.labelMinRatio=e(st),this.labelFill=e(ot),this.labelFontSizeFunc=e(G),this.tooltipFunc=e(H),this.tapFunc=e($),this.fillFunc=e(V),this.fillOpacityFunc=e(I),this.strokeFunc=e(q),this.strokeWidthFunc=e(B),this.padding=e(tt),this.width=e(X),this.height=e(Y),this.rectangleRatio=e(et),this.data=e.required(),this.flat=e(nt)}ngOnChanges(s){this.render()}render(){let s=A(this.elementRef.nativeElement);s.select("svg").remove();let n=this.data();if(!n||!n.children||n.children.length<1)return;let a=D(this.elementRef,this.width(),this.height(),X,Y),c=a[0],d=a[1],g=s.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",c).attr("height",d).attr("viewBox",`0 0 ${c} ${d}`),b=this.sort(),v=b===P?L:b===it?_:F,y=t=>{let i=C(t).sum(this.sumFunc());return v!==F&&(i=i.sort((r,m)=>v(r,m))),T().tile(O.ratio(1)).size([c/this.rectangleRatio(),d]).padding(this.padding()).round(!1)(i)},h=y(n);if(this.flat()){let t={children:[]};for(let i of h.leaves())t.children?.push(i.data);h=y(t)}let f=h.leaves(),l=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;for(let t of f)if(t.value){let i=t.value;i<l&&(l=i),i>u&&(u=i)}let R=g.selectAll("g").data(f).join("g").attr("transform",t=>`translate(${t.x0*this.rectangleRatio()},${t.y0})`);R.append("rect").attr("width",t=>t.x1*this.rectangleRatio()-t.x0*this.rectangleRatio()).attr("height",t=>t.y1-t.y0).attr("fill",t=>t.children?"transparent":this.fillFunc()(t,l,u)).attr("fill-opacity",t=>t.children?0:this.fillOpacityFunc()(t,h.height)).attr("stroke",t=>this.strokeFunc()(t)).attr("stroke-width",t=>this.strokeWidthFunc()(t)).attr("pointer-events",t=>t.children?"none":"all").on("click",(t,i)=>this.tapFunc()(i));let K=l+this.labelMinRatio()*(u-l),Q=t=>{let i=t.value?t.value>K:!1,r=t.y1-t.y0>this.labelFontSizeFunc()(t)+J,m=t.x1-t.x0>50;return i&&r&&m?this.labelFunc()(t):""};g.selectAll("g").selectAll("text").data(f).enter().append("text").style("user-select","none").attr("pointer-events","none").attr("y",J).style("fill",this.labelFill()).attr("font-size",t=>this.labelFontSizeFunc()(t)).append("tspan").data(t=>Q(t).split(/\s+/g)).join("tspan").attr("x",at).attr("y",(t,i,r)=>`${i-r.length/3+2}em`).text(t=>t),R.append("title").text(t=>this.tooltipFunc()(t))}};o.\u0275fac=function(n){return new(n||o)},o.\u0275cmp=z({type:o,selectors:[["mb-treemap"]],hostBindings:function(n,a){n&1&&M("resize",function(){return a.render()},S)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],labelFunc:[1,"labelFunc"],labelMinRatio:[1,"labelMinRatio"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],strokeFunc:[1,"strokeFunc"],strokeWidthFunc:[1,"strokeWidthFunc"],padding:[1,"padding"],width:[1,"width"],height:[1,"height"],rectangleRatio:[1,"rectangleRatio"],data:[1,"data"],flat:[1,"flat"]},features:[k],ngContentSelectors:Z,decls:1,vars:0,template:function(n,a){n&1&&(N(),E(0))},encapsulation:2,changeDetection:0});let p=o;return p})();export{zt as a};
