import{c as V,g as Y}from"./chunk-CGVYBZUD.js";import{$ as I,C as G,a as H,d as f,e as E,f as q,g as P,ha as J,k as Z,l as _}from"./chunk-FQYT43UK.js";import{a as B}from"./chunk-IEKDCRBV.js";import{Qa as X,k as L,r as j,x as A,y as T}from"./chunk-GXN2U6XA.js";import{Aa as w,Lc as n,Ub as O,Va as C,Xb as $,Yb as W,ca as z,ib as R,xa as S}from"./chunk-VOP6QBU4.js";X();var tt=["*"],F=300,et=750,K="asc",nt="desc",it=!0,ot="white",at="0px 0px 8px #000000",st=1,lt=3,ct=!1,rt=!1,wt=(()=>{let l=class l{constructor(){this.elementRef=z(w),this.sumFunc=n(H),this.sort=n(K),this.zoom=n(it),this.transitionMsec=n(et),this.labelFunc=n(P),this.labelMinRadius=n(st),this.labelFill=n(ot),this.labelShadow=n(at),this.labelFontSizeFunc=n(J),this.tooltipFunc=n(Z),this.tapFunc=n(_),this.fillFunc=n(G),this.fillOpacityFunc=n(I),this.strokeFunc=n(V),this.strokeWidthFunc=n(Y),this.padding=n(lt),this.diameter=n(F),this.data=n.required(),this.flat=n(ct),this.rootCircle=n(rt)}ngOnChanges(c){this.render()}render(){let c=L(this.elementRef.nativeElement);c.select("svg").remove();let a=this.data();if(!a||!a.children||a.children.length<1)return;let d=B(this.elementRef,this.diameter(),this.diameter(),F,F),s=Math.max(d[0],d[1]),b=s/2,m=c.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",s).attr("height",s).attr("viewBox",`-${b} -${b} ${s} ${s}`).on("click",t=>x(t,o)),M=this.sort(),v=M===K?E:M===nt?q:f,D=t=>{let e=A(t).sum(this.sumFunc());return v!==f&&(e=e.sort((i,g)=>v(i,g))),T().size([s,s]).padding(this.padding())(e)},o=D(a);if(this.flat()){let t={children:[]};for(let e of o.leaves())t.children?.push(e.data);o=D(t)}let r=o,p=m.append("g").selectAll("circle").data(this.rootCircle()?o.descendants():o.descendants().slice(1)).join("circle").attr("fill",this.fillFunc()).attr("fill-opacity",t=>this.fillOpacityFunc()(t,o.height)).attr("stroke",t=>this.strokeFunc()(t)).attr("stroke-width",t=>this.strokeWidthFunc()(t)).on("click",(t,e)=>{t.stopPropagation(),Q(t,e)}),y=t=>t.parent===r&&t.r>=this.labelMinRadius()?1:0,h=m.append("g").style("fill",this.labelFill()).style("text-shadow",this.labelShadow()).style("user-select","none").attr("pointer-events","none").attr("text-anchor","middle").selectAll("text").data(o.descendants()).enter().append("text").style("fill-opacity",y).style("font-size",t=>this.labelFontSizeFunc()(t));h.selectAll("tspan").data(t=>this.labelFunc()(t).split(/\s+/g)).join("tspan").attr("x",0).attr("y",(t,e,i)=>`${e-i.length/2+.8}em`).text(t=>t);let Q=(t,e)=>{this.tapFunc()(e),this.zoom()&&!this.flat()&&e.children&&r!==e&&x(t,e)},N,k=t=>{N=t;let e=s/t[2];h.attr("transform",i=>`translate(${(i.x-t[0])*e},${(i.y-t[1])*e+this.labelFontSizeFunc()(i)/4})`),p.attr("transform",i=>`translate(${(i.x-t[0])*e},${(i.y-t[1])*e})`),p.attr("r",i=>i.r*e)},x=(t,e)=>{r=e;let i=m.transition().duration(this.transitionMsec()).tween("zoom",()=>{let g=j(N,[r.x,r.y,r.r*2]);return U=>k(g(U))});h.transition(i).style("fill-opacity",y)};p.append("title").text(t=>this.tooltipFunc()(t)),k([o.x,o.y,o.r*2])}};l.\u0275fac=function(a){return new(a||l)},l.\u0275cmp=R({type:l,selectors:[["mb-circlepack"]],hostBindings:function(a,d){a&1&&O("resize",function(){return d.render()},C)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],zoom:[1,"zoom"],transitionMsec:[1,"transitionMsec"],labelFunc:[1,"labelFunc"],labelMinRadius:[1,"labelMinRadius"],labelFill:[1,"labelFill"],labelShadow:[1,"labelShadow"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],strokeFunc:[1,"strokeFunc"],strokeWidthFunc:[1,"strokeWidthFunc"],padding:[1,"padding"],diameter:[1,"diameter"],data:[1,"data"],flat:[1,"flat"],rootCircle:[1,"rootCircle"]},features:[S],ngContentSelectors:tt,decls:1,vars:0,template:function(a,d){a&1&&($(),W(0))},encapsulation:2,changeDetection:0});let u=l;return u})();export{wt as a};
