import{Hc as L,Ic as v,Kb as I,Kc as b,Lb as D,Lc as f,Mb as H,Mc as T,Xa as w,ca as M,cc as E,dc as O,gc as $,ib as S,ma as P,sa as C,tb as k}from"./chunk-VOP6QBU4.js";var V=["canvas"],A="hue-ring",_="saturation-ring",z="lightness-ring",N="alpha-ring",U=(()=>{let y=class y{radialSegments(e){let t=this.effectiveResolution(),s=2*Math.PI*e*t,n=Math.round(s/1.5);n=Math.max(n,360);let a=16;n=Math.round(n/a)*a;let o=Math.min(3600,s*2);return n=Math.min(n,o),Math.max(360,n)}constructor(){this.document=M(P),this.canvas=T.required("canvas"),this.alphaChannel=f(!1),this.diameter=f(280),this.ringWidth=f(24),this.handleSize=f(12),this.resolution=f("auto"),this.disabled=f(!1),this.hexValue=f("#ff4081"),this.backgroundColor=f("auto"),this.hexValueChange=b(),this.colorChange=b(),this.isDragging=C(!1),this.ctx=null,this.geometry=null,this.currentHsla=C([0,100,50,1]),this.dragTarget=null,this.effectiveResolution=L(()=>{let e=this.resolution();return e==="auto"?Math.min(window.devicePixelRatio||1,3):e}),k(()=>{this.initializeCanvas()}),v(()=>{let e=this.hexValue();if(this.isValidHex(e)||this.isValidHexa(e)){let t=this.hexToHsla(e);this.currentHsla.set(t),this.render()}}),v(()=>{this.alphaChannel(),this.diameter(),this.ringWidth(),this.handleSize(),this.effectiveResolution(),this.backgroundColor(),this.ctx&&this.initializeCanvas()})}ngOnDestroy(){this.removeEventListeners()}initializeCanvas(){let e=this.canvas().nativeElement;if(this.ctx=e.getContext("2d"),!this.ctx)return;let t=this.diameter(),s=this.effectiveResolution(),i=t*s,n=`${t}px`;e.width=i,e.height=i,e.style.width=n,e.style.height=n,this.ctx.scale(s,s),this.calculateGeometry(),this.setupEventListeners(),this.render()}calculateGeometry(){let e=this.diameter(),t=this.ringWidth(),s=this.handleSize()/2,i=this.alphaChannel(),n=e/2,a={x:n,y:n},o=n,r=4,c=o,u=c-t,h=u-r,l=h-t,d=l-r,g=d-t,m=0,x=0,p=0;i?(m=g-r,x=m-t,p=x-r):p=g-r,this.geometry={center:a,centerRadius:p,hueRingInnerRadius:u,hueRingOuterRadius:c,saturationRingInnerRadius:l,saturationRingOuterRadius:h,lightnessRingInnerRadius:g,lightnessRingOuterRadius:d,alphaRingInnerRadius:x,alphaRingOuterRadius:m,handleRadius:s}}getEffectiveBackgroundColor(){let e=this.backgroundColor();if(e==="auto"){let t=this.isDarkMode(),i=getComputedStyle(this.canvas().nativeElement).getPropertyValue("--mat-sys-surface").trim();return i?this.extractColorFromLightDark(i,t):t?"#121212":"#ffffff"}return this.resolveCssVariables(e)}extractColorFromLightDark(e,t){let s=e.match(/light-dark\(\s*([^,]+),\s*([^)]+)\s*\)/);if(s){let i=s[1].trim(),n=s[2].trim();return t?n:i}return e}isDarkMode(){let t=getComputedStyle(this.document.documentElement).getPropertyValue("color-scheme").trim();return t.includes("dark")?!0:t.includes("light")?!1:this.document.documentElement.classList.contains("dark-theme")||this.document.documentElement.classList.contains("dark")||this.document.body.classList.contains("dark-theme")||this.document.body.classList.contains("dark")?!0:typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches:(this.document.documentElement.getAttribute("data-theme")||this.document.documentElement.getAttribute("theme"))==="dark"}resolveCssVariables(e){if(!e.includes("var("))return e;try{let t=this.canvas().nativeElement,s=t.style.backgroundColor;t.style.backgroundColor=e;let n=getComputedStyle(t).backgroundColor;return t.style.backgroundColor=s,this.convertToHex(n)||n}catch(t){return console.warn("Failed to resolve CSS variable:",e,t),e}}convertToHex(e){let t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(t){let s=parseInt(t[1],10),i=parseInt(t[2],10),n=parseInt(t[3],10),a=o=>{let r=o.toString(16);return r.length===1?"0"+r:r};return`#${a(s)}${a(i)}${a(n)}`}return e}render(){if(!this.ctx||!this.geometry)return;let e=this.ctx,t=this.diameter();e.clearRect(0,0,t,t),this.drawBackground(),this.drawHueRing(),this.drawSaturationRing(),this.drawLightnessRing(),this.alphaChannel()&&this.drawAlphaRing(),this.drawCenterDisc(),this.drawHueHandle(),this.drawSaturationHandle(),this.drawLightnessHandle(),this.alphaChannel()&&this.drawAlphaHandle()}drawBackground(){if(!this.ctx||!this.geometry||this.backgroundColor()==="transparent")return;let{center:t}=this.geometry,s=2*Math.PI,i=this.getEffectiveBackgroundColor(),n=this.ctx;n.fillStyle=i,n.beginPath(),n.arc(t.x,t.y,this.geometry.hueRingInnerRadius,0,s),n.arc(t.x,t.y,this.geometry.saturationRingOuterRadius,0,s,!0),n.fill(),n.beginPath(),n.arc(t.x,t.y,this.geometry.saturationRingInnerRadius,0,s),n.arc(t.x,t.y,this.geometry.lightnessRingOuterRadius,0,s,!0),n.fill(),this.alphaChannel()?(n.beginPath(),n.arc(t.x,t.y,this.geometry.lightnessRingInnerRadius,0,s),n.arc(t.x,t.y,this.geometry.alphaRingOuterRadius,0,s,!0),n.fill(),n.beginPath(),n.arc(t.x,t.y,this.geometry.alphaRingInnerRadius,0,s),n.arc(t.x,t.y,this.geometry.centerRadius,0,s,!0),n.fill()):(n.beginPath(),n.arc(t.x,t.y,this.geometry.lightnessRingInnerRadius,0,s),n.arc(t.x,t.y,this.geometry.centerRadius,0,s,!0),n.fill())}drawHueRing(){if(!this.ctx||!this.geometry)return;let e=this.ctx,{center:t,hueRingInnerRadius:s,hueRingOuterRadius:i}=this.geometry,n=this.radialSegments((s+i)/2),a=2*Math.PI,o=Math.PI/2;for(let r=0;r<n;r++){let c=r/n*a-o,u=(r+1)/n*a-o,h=r/n*360,l=e.createRadialGradient(t.x,t.y,s,t.x,t.y,i),d=`hsl(${h}, 100%, 50%)`;l.addColorStop(0,d),l.addColorStop(1,d),e.beginPath(),e.arc(t.x,t.y,i,c,u),e.arc(t.x,t.y,s,u,c,!0),e.closePath(),e.fillStyle=l,e.fill()}}drawSaturationRing(){if(!this.ctx||!this.geometry)return;let e=this.ctx,{center:t,saturationRingInnerRadius:s,saturationRingOuterRadius:i}=this.geometry,[n]=this.currentHsla(),a=this.radialSegments((s+i)/2),o=2*Math.PI,r=Math.PI/2;for(let c=0;c<a;c++){let u=c/a*o-r,h=(c+1)/a*o-r,l=c/a*100,d=e.createRadialGradient(t.x,t.y,s,t.x,t.y,i),g=`hsl(${n}, ${l}%, 50%)`;d.addColorStop(0,g),d.addColorStop(1,g),e.beginPath(),e.arc(t.x,t.y,i,u,h),e.arc(t.x,t.y,s,h,u,!0),e.closePath(),e.fillStyle=d,e.fill()}}drawLightnessRing(){if(!this.ctx||!this.geometry)return;let e=this.ctx,{center:t,lightnessRingInnerRadius:s,lightnessRingOuterRadius:i}=this.geometry,[n,a]=this.currentHsla(),o=this.radialSegments((s+i)/2),r=2*Math.PI,c=Math.PI/2;for(let u=0;u<o;u++){let h=u/o*r-c,l=(u+1)/o*r-c,d=u/o*100,g=e.createRadialGradient(t.x,t.y,s,t.x,t.y,i),m=`hsl(${n}, ${a}%, ${d}%)`;g.addColorStop(0,m),g.addColorStop(1,m),e.beginPath(),e.arc(t.x,t.y,i,h,l),e.arc(t.x,t.y,s,l,h,!0),e.closePath(),e.fillStyle=g,e.fill()}}drawAlphaRing(){if(!this.ctx||!this.geometry)return;let e=this.ctx,{center:t,alphaRingInnerRadius:s,alphaRingOuterRadius:i}=this.geometry,[n,a,o]=this.currentHsla(),r=this.radialSegments((s+i)/2),c=2*Math.PI,u=Math.PI/2;this.drawCheckerboardRing(s,i);for(let h=0;h<r;h++){let l=h/r*c-u,d=(h+1)/r*c-u,g=h/r,m=e.createRadialGradient(t.x,t.y,s,t.x,t.y,i),x=`hsla(${n}, ${a}%, ${o}%, ${g})`;m.addColorStop(0,x),m.addColorStop(1,x),e.beginPath(),e.arc(t.x,t.y,i,l,d),e.arc(t.x,t.y,s,d,l,!0),e.closePath(),e.fillStyle=m,e.fill()}}drawCheckerboardRing(e,t){if(!this.ctx||!this.geometry)return;let s=document.createElement("canvas"),i=s.getContext("2d"),n=8,a=n*2;s.width=a,s.height=a,i.fillStyle="#f0f0f0",i.fillRect(0,0,n,n),i.fillRect(n,n,n,n),i.fillStyle="#d0d0d0",i.fillRect(n,0,n,n),i.fillRect(0,n,n,n);let o=this.ctx.createPattern(s,"repeat"),{center:r}=this.geometry,c=2*Math.PI;this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.x,r.y,t,0,c),this.ctx.arc(r.x,r.y,e,0,c,!0),this.ctx.fillStyle=o,this.ctx.fill(),this.ctx.restore()}drawCenterDisc(){if(!this.ctx||!this.geometry)return;let e=this.ctx,{center:t,centerRadius:s}=this.geometry,[i,n,a,o]=this.currentHsla(),r=2*Math.PI;this.alphaChannel()&&this.drawCheckerboardCenter(),e.beginPath(),e.arc(t.x,t.y,s,0,r),e.fillStyle=this.alphaChannel()?`hsla(${i}, ${n}%, ${a}%, ${o})`:`hsl(${i}, ${n}%, ${a}%)`,e.fill()}drawCheckerboardCenter(){if(!this.ctx||!this.geometry)return;let e=this.ctx,{center:t,centerRadius:s}=this.geometry,i=8,n=Math.ceil(s*2/i),a=2*Math.PI;e.save(),e.beginPath(),e.arc(t.x,t.y,s,0,a),e.clip();for(let o=0;o<n;o++)for(let r=0;r<n;r++){let c=(o+r)%2===0;e.fillStyle=c?"#ffffff":"#cccccc",e.fillRect(t.x-s+o*i,t.y-s+r*i,i,i)}e.restore()}drawHueHandle(){if(!this.ctx||!this.geometry)return;let e=2*Math.PI,t=Math.PI/2,[s]=this.currentHsla(),i=s/360*e-t,n=(this.geometry.hueRingInnerRadius+this.geometry.hueRingOuterRadius)/2;this.drawHandle(i,n,`hsl(${s}, 100%, 50%)`)}drawSaturationHandle(){if(!this.ctx||!this.geometry)return;let e=2*Math.PI,t=Math.PI/2,[s,i]=this.currentHsla(),n=i/100*e-t,a=(this.geometry.saturationRingInnerRadius+this.geometry.saturationRingOuterRadius)/2;this.drawHandle(n,a,`hsl(${s}, ${i}%, 50%)`)}drawLightnessHandle(){if(!this.ctx||!this.geometry)return;let e=2*Math.PI,t=Math.PI/2,[s,i,n]=this.currentHsla(),a=n/100*e-t,o=(this.geometry.lightnessRingInnerRadius+this.geometry.lightnessRingOuterRadius)/2;this.drawHandle(a,o,`hsl(${s}, ${i}%, ${n}%)`)}drawAlphaHandle(){if(!this.ctx||!this.geometry||!this.alphaChannel())return;let e=2*Math.PI,t=Math.PI/2,[s,i,n,a]=this.currentHsla(),o=a*e-t,r=(this.geometry.alphaRingInnerRadius+this.geometry.alphaRingOuterRadius)/2;this.drawHandle(o,r,`hsla(${s}, ${i}%, ${n}%, ${a})`)}drawHandle(e,t,s){if(!this.ctx||!this.geometry)return;let i=this.ctx,{center:n,handleRadius:a}=this.geometry,o=2*Math.PI,r=n.x+Math.cos(e)*t,c=n.y+Math.sin(e)*t;i.beginPath(),i.arc(r,c,a,0,o),i.fillStyle=s,i.fill(),i.strokeStyle="#ffffff",i.lineWidth=2,i.stroke(),i.strokeStyle="#000000",i.lineWidth=1,i.stroke()}setupEventListeners(){let e=this.canvas().nativeElement;e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!1}),this.document.addEventListener("mousemove",this.onMouseMove.bind(this)),this.document.addEventListener("mouseup",this.onMouseUp.bind(this)),this.document.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.document.addEventListener("touchend",this.onTouchEnd.bind(this))}removeEventListeners(){this.document.removeEventListener("mousemove",this.onMouseMove.bind(this)),this.document.removeEventListener("mouseup",this.onMouseUp.bind(this)),this.document.removeEventListener("touchmove",this.onTouchMove.bind(this)),this.document.removeEventListener("touchend",this.onTouchEnd.bind(this))}onMouseDown(e){if(this.disabled())return;e.preventDefault();let t=this.canvas().nativeElement.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.startDrag(s,i)}onTouchStart(e){if(this.disabled())return;e.preventDefault();let t=this.canvas().nativeElement.getBoundingClientRect(),s=e.touches[0],i=s.clientX-t.left,n=s.clientY-t.top;this.startDrag(i,n)}onMouseMove(e){if(!this.isDragging())return;e.preventDefault();let t=this.canvas().nativeElement.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.updateDrag(s,i)}onTouchMove(e){if(!this.isDragging())return;e.preventDefault();let t=this.canvas().nativeElement.getBoundingClientRect(),s=e.touches[0],i=s.clientX-t.left,n=s.clientY-t.top;this.updateDrag(i,n)}onMouseUp(){this.endDrag()}onTouchEnd(){this.endDrag()}startDrag(e,t){if(!this.geometry)return;let{center:s}=this.geometry,i=e-s.x,n=t-s.y,a=Math.sqrt(i*i+n*n);if(a>=this.geometry.hueRingInnerRadius&&a<=this.geometry.hueRingOuterRadius)this.dragTarget=A;else if(a>=this.geometry.saturationRingInnerRadius&&a<=this.geometry.saturationRingOuterRadius)this.dragTarget=_;else if(a>=this.geometry.lightnessRingInnerRadius&&a<=this.geometry.lightnessRingOuterRadius)this.dragTarget=z;else if(this.alphaChannel()&&a>=this.geometry.alphaRingInnerRadius&&a<=this.geometry.alphaRingOuterRadius)this.dragTarget=N;else return;this.isDragging.set(!0),this.updateDrag(e,t)}updateDrag(e,t){if(!this.geometry||!this.dragTarget)return;let s=2*Math.PI,{center:i}=this.geometry,n=e-i.x,a=t-i.y,o=Math.atan2(a,n)+Math.PI/2,r=(o<0?o+s:o)/s,[c,u,h,l]=this.currentHsla(),d=[c,u,h,l];switch(this.dragTarget){case A:d[0]=r*360;break;case _:d[1]=r*100;break;case z:d[2]=r*100;break;case N:d[3]=r;break}this.currentHsla.set(d),this.render(),this.emitColorChange()}endDrag(){this.isDragging.set(!1),this.dragTarget=null}emitColorChange(){let[e,t,s,i]=this.currentHsla(),n=this.hslaToHex(e,t,s,this.alphaChannel()?i:void 0);this.hexValueChange.emit(n);let a={hex:n,hsl:[e,t,s]};this.alphaChannel()&&(a.alpha=i),this.colorChange.emit(a)}isValidHex(e){return/^#[0-9A-Fa-f]{6}$/.test(e)}isValidHexa(e){return/^#[0-9A-Fa-f]{8}$/.test(e)}hexToHsla(e){let t=e.slice(1),s=parseInt(t.slice(0,2),16)/255,i=parseInt(t.slice(2,4),16)/255,n=parseInt(t.slice(4,6),16)/255,a=1;t.length===8&&(a=parseInt(t.slice(6,8),16)/255);let o=Math.max(s,i,n),r=Math.min(s,i,n),c=(o+r)/2,u=0,h=0;if(o!==r){let l=o-r;switch(h=c>.5?l/(2-o-r):l/(o+r),o){case s:u=(i-n)/l+(i<n?6:0);break;case i:u=(n-s)/l+2;break;case n:u=(s-i)/l+4;break}u/=6}return[u*360,h*100,c*100,a]}hslaToHex(e,t,s,i){e=e/360,t=t/100,s=s/100;let n=(h,l,d)=>(d<0&&(d+=1),d>1&&(d-=1),d<1/6?h+(l-h)*6*d:d<1/2?l:d<2/3?h+(l-h)*(2/3-d)*6:h),a,o,r;if(t===0)a=o=r=s;else{let h=s<.5?s*(1+t):s+t-s*t,l=2*s-h;a=n(l,h,e+1/3),o=n(l,h,e),r=n(l,h,e-1/3)}let c=h=>{let l=Math.round(h*255).toString(16);return l.length===1?"0"+l:l},u=`#${c(a)}${c(o)}${c(r)}`;return i!==void 0&&(u+=c(i)),u}hexToRgb(e){let t=e.replace("#",""),s=parseInt(t.slice(0,2),16),i=parseInt(t.slice(2,4),16),n=parseInt(t.slice(4,6),16);return[s,i,n]}getLuminance(e){let[t,s,i]=e.map(n=>{let a=n/255;return a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4)});return .2126*t+.7152*s+.0722*i}};y.\u0275fac=function(t){return new(t||y)},y.\u0275cmp=S({type:y,selectors:[["mb-color-ring"]],viewQuery:function(t,s){t&1&&E(s.canvas,V,5),t&2&&O()},inputs:{alphaChannel:[1,"alphaChannel"],diameter:[1,"diameter"],ringWidth:[1,"ringWidth"],handleSize:[1,"handleSize"],resolution:[1,"resolution"],disabled:[1,"disabled"],hexValue:[1,"hexValue"],backgroundColor:[1,"backgroundColor"]},outputs:{hexValueChange:"hexValueChange",colorChange:"colorChange"},decls:3,vars:2,consts:[["canvas",""],[1,"color-ring-container"]],template:function(t,s){t&1&&(I(0,"div",1),H(1,"canvas",null,0),D()),t&2&&(w(),$("dragging",s.isDragging))},styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .color-ring-container[_ngcontent-%COMP%]{display:inline-block;position:relative}[_nghost-%COMP%]   .color-ring-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block;border-radius:50%;cursor:crosshair;-webkit-user-select:none;user-select:none;touch-action:none}[_nghost-%COMP%]   .color-ring-container[_ngcontent-%COMP%]   canvas.dragging[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]   .color-ring-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]:focus{outline:2px solid var(--mat-sys-primary);outline-offset:2px}[disabled][_nghost-%COMP%]   .color-ring-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}"],changeDetection:0});let R=y;return R})();export{U as a};
