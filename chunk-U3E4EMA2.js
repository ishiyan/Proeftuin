import{$ as I,C as q,a as B,d as f,e as T,f as A,ha as Y,i as E,k as W,l as k}from"./chunk-FQYT43UK.js";import{a as j}from"./chunk-IEKDCRBV.js";import{Qa as P,k as R,x as $,z as L}from"./chunk-GXN2U6XA.js";import{Ca as w,Mc as i,Wa as O,Wb as V,Zb as C,_b as H,ca as N,ib as S,za as z}from"./chunk-54YCK6MI.js";P();var Q=["*"],_=800,X=600,U=0,tt=750,Z="asc",et="desc",it=!1,nt=!1,ot="white",st=4,G=16,Dt=(()=>{let l=class l{constructor(){this.elementRef=N(w),this.sumFunc=i(B),this.sort=i(Z),this.zoom=i(it),this.transitionMsec=i(tt),this.levels=i(U),this.labelFunc=i(E),this.labelFill=i(ot),this.labelFontSizeFunc=i(Y),this.tooltipFunc=i(W),this.tapFunc=i(k),this.fillFunc=i(q),this.fillOpacityFunc=i(I),this.width=i(_),this.height=i(X),this.data=i.required(),this.rootVisible=i(nt)}ngOnChanges(a){this.render()}render(){let a=R(this.elementRef.nativeElement);a.select("svg").remove();let o=this.data();if(!o||!o.children||o.children.length<1)return;let s=j(this.elementRef,this.width(),this.height(),_,X),g=s[0],r=s[1],J=a.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",g).attr("height",r).attr("viewBox",`0 0 ${g} ${r}`),p=this.sort(),F=p===Z?T:p===et?A:f,c=(t=>{let e=$(t).sum(this.sumFunc());F!==f&&(e=e.sort((d,n)=>F(d,n)));let u=(this.levels()<1?e.height:this.levels())+(this.rootVisible()?1:0);return L().size([s[1],(e.height+1)*s[0]/u])(e)})(o),b=c,v=this.rootVisible()?0:c.y1,h=J.selectAll("g").data(c.descendants()).join("g").attr("transform",t=>`translate(${t.y0-v},${t.x0})`),y=t=>t.x1-t.x0-Math.min(1,(t.x1-t.x0)/2),x=h.append("rect").style("cursor",t=>t.children&&t.parent?"pointer":"arrow").attr("width",t=>t.y1-t.y0-1).attr("height",t=>y(t)).attr("fill",this.fillFunc()).attr("fill-opacity",t=>this.fillOpacityFunc()(t,c.height)),M=t=>t.x1-t.x0>this.labelFontSizeFunc()(t)+G,D=h.append("text").style("user-select","none").attr("pointer-events","none").attr("x",st).attr("y",G).style("fill",this.labelFill()).attr("fill-opacity",t=>+M(t)).attr("font-size",t=>this.labelFontSizeFunc()(t));D.append("tspan").text(t=>this.labelFunc()(t)),h.append("title").text(t=>this.tooltipFunc()(t));let K=(t,e)=>{if(this.tapFunc()(e),this.zoom()&&e.children){b=b===e&&e.parent?e=e.parent:e;let u=e===c?v:0;c.each(n=>n.target={x0:(n.x0-e.x0)/(e.x1-e.x0)*r,x1:(n.x1-e.x0)/(e.x1-e.x0)*r,y0:n.y0-e.y0-u,y1:n.y1-e.y0-u});let d=h.transition().duration(this.transitionMsec()).attr("transform",n=>`translate(${n.target.y0},${n.target.x0})`);x.transition(d).attr("height",n=>y(n.target)),D.transition(d).attr("fill-opacity",n=>+M(n.target))}};x.on("click",K)}};l.\u0275fac=function(o){return new(o||l)},l.\u0275cmp=S({type:l,selectors:[["mb-icicle"]],hostBindings:function(o,s){o&1&&V("resize",function(){return s.render()},O)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],zoom:[1,"zoom"],transitionMsec:[1,"transitionMsec"],levels:[1,"levels"],labelFunc:[1,"labelFunc"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],width:[1,"width"],height:[1,"height"],data:[1,"data"],rootVisible:[1,"rootVisible"]},features:[z],ngContentSelectors:Q,decls:1,vars:0,template:function(o,s){o&1&&(C(),H(0))},encapsulation:2,changeDetection:0});let m=l;return m})();export{Dt as a};
