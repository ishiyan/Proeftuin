import{b as q,g as B}from"./chunk-CGVYBZUD.js";import{$ as I,C as V,a as W,d as f,e as L,f as _,ha as G,i as j,k as H,l as $}from"./chunk-FQYT43UK.js";import{a as T}from"./chunk-IEKDCRBV.js";import{A,B as C,Qa as U,k as E,x as O}from"./chunk-GXN2U6XA.js";import{Ca as R,Mc as e,Wa as x,Wb as w,Zb as S,_b as z,ca as D,ib as k,za as y}from"./chunk-54YCK6MI.js";U();var Z=["*"],X=300,Y=300,tt=1,et=1.618,P="asc",nt="desc",it=!1,ot="white",at=.1,lt=4,J=16,kt=(()=>{let o=class o{constructor(){this.elementRef=D(R),this.sumFunc=e(W),this.sort=e(P),this.labelFunc=e(j),this.labelMinRatio=e(at),this.labelFill=e(ot),this.labelFontSizeFunc=e(G),this.tooltipFunc=e(H),this.tapFunc=e($),this.fillFunc=e(V),this.fillOpacityFunc=e(I),this.strokeFunc=e(q),this.strokeWidthFunc=e(B),this.padding=e(tt),this.width=e(X),this.height=e(Y),this.rectangleRatio=e(et),this.data=e.required(),this.flat=e(it)}ngOnChanges(a){this.render()}render(){let a=E(this.elementRef.nativeElement);a.select("svg").remove();let i=this.data();if(!i||!i.children||i.children.length<1)return;let l=T(this.elementRef,this.width(),this.height(),X,Y),c=l[0],g=l[1],F=a.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",c).attr("height",g).attr("viewBox",`0 0 ${c} ${g}`),b=this.sort(),v=b===P?L:b===nt?_:f,M=t=>{let n=O(t).sum(this.sumFunc());return v!==f&&(n=n.sort((r,m)=>v(r,m))),C().tile(A.ratio(1)).size([c/this.rectangleRatio(),g]).padding(this.padding()).round(!1)(n)},d=M(i);if(this.flat()){let t={children:[]};for(let n of d.leaves())t.children?.push(n.data);d=M(t)}let p=d.leaves(),s=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;for(let t of p)if(t.value){let n=t.value;n<s&&(s=n),n>u&&(u=n)}let N=F.selectAll("g").data(p).join("g").attr("transform",t=>`translate(${t.x0*this.rectangleRatio()},${t.y0})`);N.append("rect").attr("width",t=>t.x1*this.rectangleRatio()-t.x0*this.rectangleRatio()).attr("height",t=>t.y1-t.y0).attr("fill",t=>t.children?"transparent":this.fillFunc()(t,s,u)).attr("fill-opacity",t=>t.children?0:this.fillOpacityFunc()(t,d.height)).attr("stroke",t=>this.strokeFunc()(t)).attr("stroke-width",t=>this.strokeWidthFunc()(t)).attr("pointer-events",t=>t.children?"none":"all").on("click",(t,n)=>this.tapFunc()(n));let K=s+this.labelMinRatio()*(u-s),Q=t=>{let n=t.value?t.value>K:!1,r=t.y1-t.y0>this.labelFontSizeFunc()(t)+J,m=t.x1-t.x0>50;return n&&r&&m?this.labelFunc()(t):""};F.selectAll("g").selectAll("text").data(p).enter().append("text").style("user-select","none").attr("pointer-events","none").attr("y",J).style("fill",this.labelFill()).attr("font-size",t=>this.labelFontSizeFunc()(t)).append("tspan").data(t=>Q(t).split(/\s+/g)).join("tspan").attr("x",lt).attr("y",(t,n,r)=>`${n-r.length/3+2}em`).text(t=>t),N.append("title").text(t=>this.tooltipFunc()(t))}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=k({type:o,selectors:[["mb-treemap"]],hostBindings:function(i,l){i&1&&w("resize",function(){return l.render()},x)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],labelFunc:[1,"labelFunc"],labelMinRatio:[1,"labelMinRatio"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],strokeFunc:[1,"strokeFunc"],strokeWidthFunc:[1,"strokeWidthFunc"],padding:[1,"padding"],width:[1,"width"],height:[1,"height"],rectangleRatio:[1,"rectangleRatio"],data:[1,"data"],flat:[1,"flat"]},features:[y],ngContentSelectors:Z,decls:1,vars:0,template:function(i,l){i&1&&(S(),z(0))},encapsulation:2,changeDetection:0});let h=o;return h})();export{kt as a};
