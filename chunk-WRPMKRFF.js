import{c as B,g as G}from"./chunk-CGVYBZUD.js";import{$ as Y,C as X,a as $,d as f,e as j,f as H,g as P,ha as Z,j as V,l as q}from"./chunk-W7HSUCHK.js";import{a as lt,b as ct}from"./chunk-YBW7TLA4.js";import{a as D}from"./chunk-IEKDCRBV.js";import{Qa as rt,e as A,k as L,x as _}from"./chunk-I7MJ6SML.js";import{Aa as N,Tb as O,Wb as T,Xb as z,_a as I,ca as k,ja as W,nb as E,za as e}from"./chunk-R5QK5SBI.js";import{g as S}from"./chunk-6NE7JDAX.js";var U=S(lt());rt();var tt=S(ct());var ht=["*"],m=Math.PI/180,pt="circle",J=300,K=300,Q="asc",dt="desc",ut="white",ft="0px 0px 8px #000000",mt=.1,gt=3,Ft=!1,vt=.01,bt=.01,yt=50,Rt=i=>{switch(i){case"triangle":return 3;case"diamond":return 4;case"square":return 4;case"pentagon":return 5;case"hexagon":return 6;case"heptagon":return 7;case"octagon":return 8;default:return 100}},xt=i=>{switch(i){case"triangle":return 30*m;case"square":return 45*m;case"pentagon":return 54*m;default:return 0}},qt=(()=>{class i{constructor(){this.elementRef=k(N),this.sumFunc=e($),this.sort=e(Q),this.labelFunc=e(P),this.labelMinRatio=e(mt),this.labelFill=e(ut),this.labelShadow=e(ft),this.labelFontSizeFunc=e(Z),this.tooltipFunc=e(V),this.tapFunc=e(q),this.fillFunc=e(X),this.fillOpacityFunc=e(Y),this.strokeFunc=e(B),this.strokeWidthFunc=e(G),this.padding=e(gt),this.width=e(J),this.height=e(K),this.shape=e(pt),this.convergenceRatio=e(vt),this.minWeightRatio=e(bt),this.maxIterationCount=e(yt),this.data=e.required(),this.flat=e(Ft)}render(){let r=L(this.elementRef.nativeElement);r.select("svg").remove();let o=this.data();if(!o||!o.children||o.children.length<1)return;let a=this.padding(),s=a*2,g=D(this.elementRef,this.width(),this.height(),J,K),p=g[0]-s,d=g[1]-s,F=p/2,v=d/2,b=this.sort(),y=b===Q?j:b===dt?H:f,R=t=>{let n=_(t).sum(this.sumFunc());return y!==f&&(n=n.sort((u,st)=>y(u,st))),n},l=R(o);if(this.flat()){let t={name:"root",children:[]};for(let n of l.leaves())t.children?.push(n.data);l=R(t)}let x=Rt(this.shape()),et=2*Math.PI/x,nt=xt(this.shape()),ot=A(x).map(t=>{let n=nt+t*et;return[F+F*Math.cos(n),v+v*Math.sin(n)]});tt.voronoiTreemap().prng((0,U.alea)(12345)).convergenceRatio(this.convergenceRatio()).maxIterationCount(this.maxIterationCount()).minWeightRatio(this.minWeightRatio()).clip(ot)(l);let w=l.descendants().sort((t,n)=>n.depth-t.depth).map((t,n)=>Object.assign({},t,{id:n})),M=w.filter(t=>!t.children),c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(let t of M)if(t.value){let n=t.value;n<c&&(c=n),n>h&&(h=n)}let C=r.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",p+s).attr("height",d+s).attr("viewBox",`0 0 ${p+s} ${d+s}`);C.append("g").attr("transform",`translate(${a},${a})`).selectAll("path").data(w).enter().append("path").attr("d",t=>"M"+t.polygon.join("L")+"Z").attr("fill",t=>t.children?"transparent":this.fillFunc()(t,c,h)).attr("fill-opacity",t=>t.children?0:this.fillOpacityFunc()(t,l.height)).attr("stroke",t=>this.strokeFunc()(t)).attr("stroke-width",t=>this.strokeWidthFunc()(t)).attr("pointer-events",t=>t.children?"none":"all").on("click",(t,n)=>this.tapFunc()(n)).append("title").text(t=>t.children?"":this.tooltipFunc()(t));let it=c+this.labelMinRatio()*(h-c),at=t=>t.value&&t.value>it?1:0;C.append("g").attr("transform",`translate(${a},${a})`).style("user-select","none").attr("pointer-events","none").attr("text-anchor","middle").selectAll("text").data(M).enter().append("text").attr("transform",t=>"translate("+[t.polygon.site.x,t.polygon.site.y]+")").style("fill",this.labelFill()).style("text-shadow",this.labelShadow()).style("fill-opacity",at).style("font-size",t=>this.labelFontSizeFunc()(t)).selectAll("tspan").data(t=>this.labelFunc()(t).split(/\s+/g)).join("tspan").attr("x",0).attr("y",(t,n,u)=>`${n-u.length/2+.8}em`).text(t=>t)}ngOnChanges(r){this.render()}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=E({type:i,selectors:[["mb-voronoi"]],hostBindings:function(o,a){o&1&&O("resize",function(){return a.render()},!1,I)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],labelFunc:[1,"labelFunc"],labelMinRatio:[1,"labelMinRatio"],labelFill:[1,"labelFill"],labelShadow:[1,"labelShadow"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],strokeFunc:[1,"strokeFunc"],strokeWidthFunc:[1,"strokeWidthFunc"],padding:[1,"padding"],width:[1,"width"],height:[1,"height"],shape:[1,"shape"],convergenceRatio:[1,"convergenceRatio"],minWeightRatio:[1,"minWeightRatio"],maxIterationCount:[1,"maxIterationCount"],data:[1,"data"],flat:[1,"flat"]},features:[W],ngContentSelectors:ht,decls:1,vars:0,template:function(o,a){o&1&&(T(),z(0))},encapsulation:2,changeDetection:0})}}return i})();export{qt as a};
