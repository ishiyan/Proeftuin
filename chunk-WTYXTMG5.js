import{$ as Z,C as Y,a as k,d as F,e as E,f as V,ha as G,i as q,k as I,l as W}from"./chunk-W7HSUCHK.js";import{a as _}from"./chunk-IEKDCRBV.js";import{Qa as tt,k as j,q as L,x as B,z as H,za as P}from"./chunk-I7MJ6SML.js";import{Aa as R,Tb as T,Wb as $,Xb as N,_a as D,ca as C,ja as O,nb as A,za as i}from"./chunk-R5QK5SBI.js";tt();var et=["*"],g=2*Math.PI,nt=180/Math.PI,x=300,it=0,st=750,J="asc",at="desc",rt=!1,ot="white",Ct=(()=>{class m{constructor(){this.elementRef=C(R),this.sumFunc=i(k),this.sort=i(J),this.zoom=i(rt),this.transitionMsec=i(st),this.levels=i(it),this.labelFunc=i(q),this.labelFill=i(ot),this.labelFontSizeFunc=i(G),this.tooltipFunc=i(I),this.tapFunc=i(W),this.fillFunc=i(Y),this.fillOpacityFunc=i(Z),this.diameter=i(x),this.data=i.required()}ngOnChanges(o){this.render()}render(){let o=j(this.elementRef.nativeElement);o.select("svg").remove();let s=this.data();if(!s||!s.children||s.children.length<1)return;let u=_(this.elementRef,this.diameter(),this.diameter(),x,x),r=Math.max(u[0],u[1]),y=r/2,p=o.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",r).attr("height",r).attr("viewBox",`0 0 ${r} ${r}`).append("g").attr("transform",`translate(${y},${y})`),b=this.sort(),v=b===J?E:b===at?V:F,a=(t=>{let n=B(t).sum(this.sumFunc());return v!==F&&(n=n.sort((c,e)=>v(c,e))),H().size([g,n.height+1])(n)})(s);a.each(t=>t.current=t);let f=(this.levels()<1?a.height:this.levels())+1,l=r/(2*f),M=P().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(l*1.5).innerRadius(t=>t.y0*l).outerRadius(t=>Math.max(t.y0*l,t.y1*l-1)),h=t=>t.y1<=f&&t.y0>=1&&t.x1>t.x0,d=t=>t.y1<=f&&t.y0>=1&&(t.y1-t.y0)*(t.x1-t.x0)>.05,z=t=>{let n=(t.x0+t.x1)/2*nt,c=(t.y0+t.y1)/2*l;return`rotate(${n-90}) translate(${c},0) rotate(${n<180?0:180})`},S=(t,n)=>{if(this.tapFunc()(n),this.zoom()&&n.children){Q.datum(n.parent||a),a.each(e=>e.target={x0:Math.max(0,Math.min(1,(e.x0-n.x0)/(n.x1-n.x0)))*g,x1:Math.max(0,Math.min(1,(e.x1-n.x0)/(n.x1-n.x0)))*g,y0:Math.max(0,e.y0-n.depth),y1:Math.max(0,e.y1-n.depth)});let c=p.transition().duration(this.transitionMsec());w.transition(c).tween("data",e=>{let U=L(e.current,e.target);return X=>e.current=U(X)}).filter(e=>h(e.current)||h(e.target)).attr("fill-opacity",e=>h(e.target)?this.fillOpacityFunc()(e,a.height):0).attrTween("d",e=>()=>M(e.current)),K.filter(e=>h(e.current)||d(e.target)).transition(c).attr("fill-opacity",e=>+d(e.target)).attrTween("transform",e=>()=>z(e.current))}},w=p.append("g").selectAll("path").data(a.descendants().slice(1)).join("path").attr("fill",this.fillFunc()).attr("fill-opacity",t=>h(t.current)?this.fillOpacityFunc()(t,a.height):0).attr("d",t=>M(t.current)).on("click",S);w.append("title").text(t=>this.tooltipFunc()(t));let K=p.append("g").attr("pointer-events","none").attr("text-anchor","middle").style("user-select","none").style("fill",this.labelFill()).selectAll("text").data(a.descendants().slice(1)).join("text").attr("font-size",t=>this.labelFontSizeFunc()(t)).attr("dy","0.35em").attr("fill-opacity",t=>+d(t.current)).attr("transform",t=>z(t.current)).text(t=>this.labelFunc()(t)),Q=p.append("circle").datum(a).attr("r",l).attr("fill","none").attr("pointer-events","all").on("click",S)}static{this.\u0275fac=function(s){return new(s||m)}}static{this.\u0275cmp=A({type:m,selectors:[["mb-sunburst"]],hostBindings:function(s,u){s&1&&T("resize",function(){return u.render()},!1,D)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],zoom:[1,"zoom"],transitionMsec:[1,"transitionMsec"],levels:[1,"levels"],labelFunc:[1,"labelFunc"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],diameter:[1,"diameter"],data:[1,"data"]},features:[O],ngContentSelectors:et,decls:1,vars:0,template:function(s,u){s&1&&($(),N(0))},encapsulation:2,changeDetection:0})}}return m})();export{Ct as a};
