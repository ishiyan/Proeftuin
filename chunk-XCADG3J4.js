import{$ as W,C as E,a as j,d as p,e as B,f as I,ha as k,i as T,k as _,l as A}from"./chunk-W7HSUCHK.js";import{a as L}from"./chunk-IEKDCRBV.js";import{Qa as K,k as N,x as R,z as $}from"./chunk-I7MJ6SML.js";import{Aa as M,Tb as V,Wb as D,Xb as H,_a as O,ca as w,ja as C,nb as S,za as i}from"./chunk-R5QK5SBI.js";K();var P=["*"],q=800,Y=600,Q=0,U=750,X="asc",tt="desc",et=!1,it=!1,nt="white",ot=4,Z=16,zt=(()=>{class r{constructor(){this.elementRef=w(M),this.sumFunc=i(j),this.sort=i(X),this.zoom=i(et),this.transitionMsec=i(U),this.levels=i(Q),this.labelFunc=i(T),this.labelFill=i(nt),this.labelFontSizeFunc=i(k),this.tooltipFunc=i(_),this.tapFunc=i(A),this.fillFunc=i(E),this.fillOpacityFunc=i(W),this.width=i(q),this.height=i(Y),this.data=i.required(),this.rootVisible=i(it)}ngOnChanges(l){this.render()}render(){let l=N(this.elementRef.nativeElement);l.select("svg").remove();let o=this.data();if(!o||!o.children||o.children.length<1)return;let s=L(this.elementRef,this.width(),this.height(),q,Y),f=s[0],a=s[1],G=l.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",f).attr("height",a).attr("viewBox",`0 0 ${f} ${a}`),d=this.sort(),F=d===X?B:d===tt?I:p,c=(t=>{let e=R(t).sum(this.sumFunc());F!==p&&(e=e.sort((m,n)=>F(m,n)));let u=(this.levels()<1?e.height:this.levels())+(this.rootVisible()?1:0);return $().size([s[1],(e.height+1)*s[0]/u])(e)})(o),g=c,y=this.rootVisible()?0:c.y1,h=G.selectAll("g").data(c.descendants()).join("g").attr("transform",t=>`translate(${t.y0-y},${t.x0})`),x=t=>t.x1-t.x0-Math.min(1,(t.x1-t.x0)/2),b=h.append("rect").style("cursor",t=>t.children&&t.parent?"pointer":"arrow").attr("width",t=>t.y1-t.y0-1).attr("height",t=>x(t)).attr("fill",this.fillFunc()).attr("fill-opacity",t=>this.fillOpacityFunc()(t,c.height)),v=t=>t.x1-t.x0>this.labelFontSizeFunc()(t)+Z,z=h.append("text").style("user-select","none").attr("pointer-events","none").attr("x",ot).attr("y",Z).style("fill",this.labelFill()).attr("fill-opacity",t=>+v(t)).attr("font-size",t=>this.labelFontSizeFunc()(t));z.append("tspan").text(t=>this.labelFunc()(t)),h.append("title").text(t=>this.tooltipFunc()(t));let J=(t,e)=>{if(this.tapFunc()(e),this.zoom()&&e.children){g=g===e&&e.parent?e=e.parent:e;let u=e===c?y:0;c.each(n=>n.target={x0:(n.x0-e.x0)/(e.x1-e.x0)*a,x1:(n.x1-e.x0)/(e.x1-e.x0)*a,y0:n.y0-e.y0-u,y1:n.y1-e.y0-u});let m=h.transition().duration(this.transitionMsec()).attr("transform",n=>`translate(${n.target.y0},${n.target.x0})`);b.transition(m).attr("height",n=>x(n.target)),z.transition(m).attr("fill-opacity",n=>+v(n.target))}};b.on("click",J)}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275cmp=S({type:r,selectors:[["mb-icicle"]],hostBindings:function(o,s){o&1&&V("resize",function(){return s.render()},!1,O)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],zoom:[1,"zoom"],transitionMsec:[1,"transitionMsec"],levels:[1,"levels"],labelFunc:[1,"labelFunc"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],width:[1,"width"],height:[1,"height"],data:[1,"data"],rootVisible:[1,"rootVisible"]},features:[C],ngContentSelectors:P,decls:1,vars:0,template:function(o,s){o&1&&(D(),H(0))},encapsulation:2,changeDetection:0})}}return r})();export{zt as a};
