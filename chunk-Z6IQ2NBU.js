import{b as $,g as q}from"./chunk-CGVYBZUD.js";import{$ as V,C as B,a as _,d as m,e as D,f as W,ha as I,i as L,k as j,l as H}from"./chunk-EWUHWUKW.js";import{a as O}from"./chunk-IEKDCRBV.js";import{A as E,B as A,Qa as Q,k as C,x as T}from"./chunk-HICUQHPW.js";import{$a as w,Aa as e,Ba as k,Vb as z,Yb as M,Zb as N,da as R,ka as x,ob as S}from"./chunk-BLTBCMH5.js";Q();var U=["*"],G=300,X=300,Z=1,tt=1.618,Y="asc",et="desc",it=!1,nt="white",ot=.1,st=4,P=16,St=(()=>{class r{constructor(){this.elementRef=R(k),this.sumFunc=e(_),this.sort=e(Y),this.labelFunc=e(L),this.labelMinRatio=e(ot),this.labelFill=e(nt),this.labelFontSizeFunc=e(I),this.tooltipFunc=e(j),this.tapFunc=e(H),this.fillFunc=e(B),this.fillOpacityFunc=e(V),this.strokeFunc=e($),this.strokeWidthFunc=e(q),this.padding=e(Z),this.width=e(G),this.height=e(X),this.rectangleRatio=e(tt),this.data=e.required(),this.flat=e(it)}ngOnChanges(o){this.render()}render(){let o=C(this.elementRef.nativeElement);o.select("svg").remove();let n=this.data();if(!n||!n.children||n.children.length<1)return;let s=O(this.elementRef,this.width(),this.height(),G,X),c=s[0],p=s[1],F=o.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",c).attr("height",p).attr("viewBox",`0 0 ${c} ${p}`),g=this.sort(),b=g===Y?D:g===et?W:m,v=t=>{let i=T(t).sum(this.sumFunc());return b!==m&&(i=i.sort((l,f)=>b(l,f))),A().tile(E.ratio(1)).size([c/this.rectangleRatio(),p]).padding(this.padding()).round(!1)(i)},h=v(n);if(this.flat()){let t={children:[]};for(let i of h.leaves())t.children?.push(i.data);h=v(t)}let d=h.leaves(),a=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;for(let t of d)if(t.value){let i=t.value;i<a&&(a=i),i>u&&(u=i)}let y=F.selectAll("g").data(d).join("g").attr("transform",t=>`translate(${t.x0*this.rectangleRatio()},${t.y0})`);y.append("rect").attr("width",t=>t.x1*this.rectangleRatio()-t.x0*this.rectangleRatio()).attr("height",t=>t.y1-t.y0).attr("fill",t=>t.children?"transparent":this.fillFunc()(t,a,u)).attr("fill-opacity",t=>t.children?0:this.fillOpacityFunc()(t,h.height)).attr("stroke",t=>this.strokeFunc()(t)).attr("stroke-width",t=>this.strokeWidthFunc()(t)).attr("pointer-events",t=>t.children?"none":"all").on("click",(t,i)=>this.tapFunc()(i));let J=a+this.labelMinRatio()*(u-a),K=t=>{let i=t.value?t.value>J:!1,l=t.y1-t.y0>this.labelFontSizeFunc()(t)+P,f=t.x1-t.x0>50;return i&&l&&f?this.labelFunc()(t):""};F.selectAll("g").selectAll("text").data(d).enter().append("text").style("user-select","none").attr("pointer-events","none").attr("y",P).style("fill",this.labelFill()).attr("font-size",t=>this.labelFontSizeFunc()(t)).append("tspan").data(t=>K(t).split(/\s+/g)).join("tspan").attr("x",st).attr("y",(t,i,l)=>`${i-l.length/3+2}em`).text(t=>t),y.append("title").text(t=>this.tooltipFunc()(t))}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=S({type:r,selectors:[["mb-treemap"]],hostBindings:function(n,s){n&1&&z("resize",function(){return s.render()},!1,w)},inputs:{sumFunc:[1,"sumFunc"],sort:[1,"sort"],labelFunc:[1,"labelFunc"],labelMinRatio:[1,"labelMinRatio"],labelFill:[1,"labelFill"],labelFontSizeFunc:[1,"labelFontSizeFunc"],tooltipFunc:[1,"tooltipFunc"],tapFunc:[1,"tapFunc"],fillFunc:[1,"fillFunc"],fillOpacityFunc:[1,"fillOpacityFunc"],strokeFunc:[1,"strokeFunc"],strokeWidthFunc:[1,"strokeWidthFunc"],padding:[1,"padding"],width:[1,"width"],height:[1,"height"],rectangleRatio:[1,"rectangleRatio"],data:[1,"data"],flat:[1,"flat"]},features:[x],ngContentSelectors:U,decls:1,vars:0,template:function(n,s){n&1&&(M(),N(0))},encapsulation:2,changeDetection:0})}}return r})();export{St as a};
